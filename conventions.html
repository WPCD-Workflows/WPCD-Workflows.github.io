

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>8. Conventions &mdash; EUROfusion Integrated Modelling workflows 3.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="9. AMNS" href="amns.html" />
    <link rel="prev" title="7. Codes" href="codes.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> EUROfusion Integrated Modelling workflows
          

          
            
            <img src="_static/wpcd_banner_new.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">1. Introduction to the EUROfusion Project Code Development for integrated modelling</a></li>
<li class="toctree-l1"><a class="reference internal" href="infrastructure.html">2. Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="ets.html">3. European Transport Simulator (ETS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="es.html">4. Equilibrium and MHD Stability workflow (EQSTABIL)</a></li>
<li class="toctree-l1"><a class="reference internal" href="eqreconstr.html">5. The EQRECONSTRUCT workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="turbulence.html">6. Turbulence with synthetic diagnostics workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="codes.html">7. Codes</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">8. Conventions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#standard-machine-names">8.1. Standard Machine Names</a></li>
<li class="toctree-l2"><a class="reference internal" href="#physics-conventions">8.2. Physics Conventions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#coordinate-system">8.2.1. Coordinate System</a></li>
<li class="toctree-l3"><a class="reference internal" href="#representation-of-the-magnetic-field-and-current">8.2.2. Representation of the Magnetic Field and Current</a></li>
<li class="toctree-l3"><a class="reference internal" href="#poloidal-and-toroidal-fluxes">8.2.3. Poloidal and Toroidal Fluxes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#safety-factor">8.2.4. Safety Factor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#signs">8.2.5. Signs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cocos-toroidal-coordinate-conventions">8.2.6. COCOS - toroidal coordinate conventions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#equilibrium-cocos-transformation-library-and-actor">8.2.6.1. Equilibrium COCOS transformation library and actor</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#the-flux-surface-average">8.2.7. The Flux Surface Average</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-toroidal-flux-radius-as-the-radial-coordinate">8.2.8. The Toroidal Flux Radius as the Radial Coordinate</a></li>
<li class="toctree-l3"><a class="reference internal" href="#toroidal-and-parallel-current">8.2.9. Toroidal and Parallel Current</a></li>
<li class="toctree-l3"><a class="reference internal" href="#straight-field-line-coordinates">8.2.10. Straight Field Line Coordinates</a></li>
<li class="toctree-l3"><a class="reference internal" href="#plasma-betas">8.2.11. Plasma Betas</a></li>
<li class="toctree-l3"><a class="reference internal" href="#internal-inductance">8.2.12. Internal Inductance</a></li>
<li class="toctree-l3"><a class="reference internal" href="#poloidal-angle-dimension-in-equilibrium-cpo">8.2.13. Poloidal Angle Dimension in Equilibrium CPO</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#numerical-and-computational-conventions">8.3. Numerical and computational conventions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#standardized-variable-types">8.3.1. Standardized Variable Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="#standardized-physical-constants">8.3.2. Standardized Physical Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="#invalid-data-base-entries">8.3.3. Invalid Data Base Entries</a></li>
<li class="toctree-l3"><a class="reference internal" href="#enumerated-datatypes-identifiers">8.3.4. Enumerated datatypes/Identifiers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#example-how-to-fill-coresource-values-sourceid">8.3.4.1. Example: How to fill coresource/values/sourceid</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#grid-types-in-equilibrium-cpo">8.3.5. Grid Types in Equilibrium CPO</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#grid-type-identifier">8.3.5.1. Grid Type Identifier</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#standardized-eu-eu-im-plasma-bundle">8.3.6. Standardized EU-EU-IM Plasma Bundle</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="amns.html">9. AMNS</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">10. Additional resources</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">EUROfusion Integrated Modelling workflows</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><span class="section-number">8. </span>Conventions</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/WPCD-Workflows/documentation/blob/master/source/conventions.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="conventions">
<span id="itm-conventions"></span><h1><span class="section-number">8. </span>Conventions<a class="headerlink" href="#conventions" title="Permalink to this headline">¶</a></h1>
<div class="section" id="standard-machine-names">
<span id="machine-names"></span><h2><span class="section-number">8.1. </span>Standard Machine Names<a class="headerlink" href="#standard-machine-names" title="Permalink to this headline">¶</a></h2>
<p>The following machine names are suggested:</p>
<ul class="simple">
<li><p>aug</p></li>
<li><p>ftu</p></li>
<li><p>iter</p></li>
<li><p>jet</p></li>
<li><p>mast</p></li>
<li><p>tcv</p></li>
<li><p>tore_supra</p></li>
<li><p>west</p></li>
</ul>
</div>
<div class="section" id="physics-conventions">
<span id="id1"></span><h2><span class="section-number">8.2. </span>Physics Conventions<a class="headerlink" href="#physics-conventions" title="Permalink to this headline">¶</a></h2>
<p>The EU-IM-TF has agreed on a variety of conventions to facilitate the
integration of the code modules across EFDA. In the following the most
important conventions are explained in detail to remove confusion and
avoid ambiguity. For more physical detail than that represented here see
F Hinton and R Hazeltine, Rev Mod Phys 48 (1976) 239-308, or R Hazeltine
and J Meiss, Plasma Confinement (Addison-Wesley, 1992).</p>
<div class="section" id="coordinate-system">
<span id="itm-coordinate-system"></span><h3><span class="section-number">8.2.1. </span>Coordinate System<a class="headerlink" href="#coordinate-system" title="Permalink to this headline">¶</a></h3>
<p>There are generally two choices for defining a right-handed coordinate
system in a toroidal geometry with the following coordinates:</p>
<ul class="simple">
<li><p>major radius R</p></li>
<li><p>vertical heights Z</p></li>
<li><p>toroidal angle <span class="math notranslate nohighlight">\(\phi\)</span></p></li>
</ul>
<p>Remaining consistent with ITER, the EU-IM-TF has chosen to adopt the
right-handed system</p>
<div class="math notranslate nohighlight">
\[(R, \phi, Z)\]</div>
<p>i.e. R is to the right, Z is upwards, and <span class="math notranslate nohighlight">\(\phi\)</span> points into the plane
on the right-hand side of the torus (i.e. mathematically positive). Looking
from above, the toroidal angle is counter-clockwise, i.e. mathematically
positive.</p>
<p>The following figures demonstrate the orientation of the toroidal angle
<span class="math notranslate nohighlight">\(\phi\)</span> and the poloidal angle <span class="math notranslate nohighlight">\(\theta\)</span>:</p>
<div class="figure align-center">
<img alt="_images/conventions_1.png" src="_images/conventions_1.png" />
</div>
<div class="figure align-center">
<img alt="_images/conventions_2.png" src="_images/conventions_2.png" />
</div>
<p>source:</p>
<p><a class="reference external" href="http://www-fusion.ciemat.es/fusionwiki/index.php/Toroidal_coordinates">http://www-fusion.ciemat.es/fusionwiki/index.php/Toroidal_coordinates</a></p>
<p><a class="reference external" href="http://en.wikipedia.org/wiki/Toroidal_and_poloidal">http://en.wikipedia.org/wiki/Toroidal_and_poloidal</a></p>
</div>
<div class="section" id="representation-of-the-magnetic-field-and-current">
<span id="itm-conventions-representation-of-the-magnetic-field-and-current"></span><h3><span class="section-number">8.2.2. </span>Representation of the Magnetic Field and Current<a class="headerlink" href="#representation-of-the-magnetic-field-and-current" title="Permalink to this headline">¶</a></h3>
<p>Generally, the magnetic field is described in terms of two scalar fields as
it is divergence free. If the field is also axisymmetric then MHD
equilibrium demands these are functions of each other. In the EU-IM-TF the
relevant quantities are <span class="math notranslate nohighlight">\(F_{{\rm dia}}\)</span> and <span class="math notranslate nohighlight">\(\Psi\)</span> and the
representation is</p>
<div class="math notranslate nohighlight">
\[{\bf B} = F_{{\rm dia}} \nabla \phi +(2\pi)^{-1} \nabla \Psi \times \nabla \phi\]</div>
<p>where the factor of <span class="math notranslate nohighlight">\(2 \pi\)</span> is to have <span class="math notranslate nohighlight">\(\Psi\)</span> one and the same with
the poloidal flux in Webers (see below).</p>
<p>The current given by Ampere’s law is</p>
<div class="math notranslate nohighlight">
\[\mu_0 {\bf J} = \nabla F_{{\rm dia}} \times \nabla \phi - (2\pi)^{-1}(R^2 \nabla \cdot R^{-2} \nabla \Psi) \nabla \phi\]</div>
<p>The respective covariant toroidal components are useful forms:</p>
<div class="math notranslate nohighlight">
\[B_\phi =F_{{\rm dia}} \qquad \qquad \mu_0 J_\phi = - (2\pi)^{-1}(R^2 \nabla\cdot R^{-2} \nabla \Psi)\]</div>
<p>where the latter is often expressed in terms of the “delta-star” operator,
<span class="math notranslate nohighlight">\(\Delta^* = R^2 \nabla \cdot R^{-2} \nabla\)</span>. These are not the
toroidal field and current but the toroidal field and current multiplied by
<span class="math notranslate nohighlight">\(R\)</span> respectively. The total plasma current <span class="math notranslate nohighlight">\(I_p\)</span> is the integral
of <span class="math notranslate nohighlight">\(J_{\phi} / R\)</span> over the poloidal cross section (usually, but
not always, over the closed flux surface region only).</p>
</div>
<div class="section" id="poloidal-and-toroidal-fluxes">
<span id="itm-conventions-poloidal-and-toroidal-fluxes"></span><h3><span class="section-number">8.2.3. </span>Poloidal and Toroidal Fluxes<a class="headerlink" href="#poloidal-and-toroidal-fluxes" title="Permalink to this headline">¶</a></h3>
<p>The toroidal flux <span class="math notranslate nohighlight">\(\Phi\)</span> is the integral of <span class="math notranslate nohighlight">\(B_{\phi} / R\)</span> over
the region enclosed by the flux surface. Due to axisymmetry it is also a
volume integral</p>
<div class="math notranslate nohighlight">
\[\Phi = \oint d^3V (2 \pi R^2)^{-1} F_{{\rm dia}}\]</div>
<p>All volume integrals are understood as integration over the region enclosed
by the flux surface. They are therefore flux quantities (pure functions of
<span class="math notranslate nohighlight">\(\Psi\)</span>). The units of <span class="math notranslate nohighlight">\(\Phi\)</span> are volt-seconds, or Webers (Wb).</p>
<p>The poloidal flux is <span class="math notranslate nohighlight">\(\Psi\)</span> due to the construction of <span class="math notranslate nohighlight">\(\bf B\)</span>.
The factor of <span class="math notranslate nohighlight">\(2 \pi\)</span> ensures this is not Wb per radian (the
more usual quantity <span class="math notranslate nohighlight">\(\psi\)</span> used as a covariant toroidal component
of the magnetic potential is in Wb/radian; the factor of <span class="math notranslate nohighlight">\(2 \pi\)</span>
results from integration over one angular circuit). Note that the
poloidal flux <span class="math notranslate nohighlight">\(\Psi\)</span> and its equivalent per radian <span class="math notranslate nohighlight">\(\psi\)</span>
are often used equivalently in the literature.</p>
</div>
<div class="section" id="safety-factor">
<span id="itm-conventions-safety-factor"></span><h3><span class="section-number">8.2.4. </span>Safety Factor<a class="headerlink" href="#safety-factor" title="Permalink to this headline">¶</a></h3>
<p>The magnetic pitch parameter is defined in terms of the flux components:</p>
<div class="math notranslate nohighlight">
\[q\equiv d \Phi d \Psi\]</div>
<p>which is a flux quantity. This definition is the same as saying the
magnetic pitch is given as the number of toroidal cycle a magnetic field
line traverses per unit poloidal cycle. It is also called the local safety
factor for MHD stability reasons (here, “local” means local to a given flux
surface). Equivalent relations often seen depend on the definition of
coordinates. These are given for straight field line coordinates, below.</p>
</div>
<div class="section" id="signs">
<span id="itm-conventions-signs"></span><h3><span class="section-number">8.2.5. </span>Signs<a class="headerlink" href="#signs" title="Permalink to this headline">¶</a></h3>
<p>With the above definition of the toroidal coordinate system and the
magnetic field, the following sign relationships ensue (where increasing
and decreasing refer to going from the magnetic axis to the separatrix
on the outboard midplane):</p>
<table class="docutils align-default" id="id3">
<caption><span class="caption-number">Table 8.1 </span><span class="caption-text">Sign Relations</span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 23%" />
<col style="width: 19%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 19%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><span class="math notranslate nohighlight">\(B_{tor}\)</span></p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(I_{p}\)</span></p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(\Psi\)</span></p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(\Phi\)</span></p></th>
<th class="head"><p>safety
factor
<span class="math notranslate nohighlight">\(q\)</span></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>positive</p></td>
<td><p>positive</p></td>
<td><p>decreasing</p></td>
<td><p>increasing</p></td>
<td><p>negative</p></td>
</tr>
<tr class="row-odd"><td><p>positive</p></td>
<td><p>negative</p></td>
<td><p>increasing</p></td>
<td><p>increasing</p></td>
<td><p>positive</p></td>
</tr>
<tr class="row-even"><td><p>negative</p></td>
<td><p>positive</p></td>
<td><p>decreasing</p></td>
<td><p>decreasing</p></td>
<td><p>positive</p></td>
</tr>
<tr class="row-odd"><td><p>negative</p></td>
<td><p>negative</p></td>
<td><p>increasing</p></td>
<td><p>decreasing</p></td>
<td><p>negative</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="cocos-toroidal-coordinate-conventions">
<span id="itm-conventions-cocos"></span><h3><span class="section-number">8.2.6. </span>COCOS - toroidal coordinate conventions<a class="headerlink" href="#cocos-toroidal-coordinate-conventions" title="Permalink to this headline">¶</a></h3>
<p>16 different fundamental coordinate conventions (COCOS) has been identified
for toroidal systems. These are described by <a class="reference external" href="http://www.sciencedirect.com/science/article/pii/S0010465512002962">O. Sauter and S. Yu. Medvedev, Computer Phys. Commun. 184 (2013) 293</a>.</p>
<p>The current EU-IM convention (described
above) is number 13, while the ITER convention is 11.</p>
<div class="section" id="equilibrium-cocos-transformation-library-and-actor">
<span id="itm-conventions-cocos-conversions"></span><span id="itm-conventions-cocos-determine"></span><h4><span class="section-number">8.2.6.1. </span>Equilibrium COCOS transformation library and actor<a class="headerlink" href="#equilibrium-cocos-transformation-library-and-actor" title="Permalink to this headline">¶</a></h4>
<p>A Fortran library has been developed for transforming the equilibrium
cpo between different COCOS. The source is found in</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">https://gforge6.eufus.eu/svn/numerical_tools/tags/COCOStransform_v1_1</span>
</pre></div>
</div>
<p>and the actor is</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">https://gforge6.eufus.eu/svn/kepleractors/tags/4.09a/imp12/COCOStransformequil.tar</span>
</pre></div>
</div>
<p>(also available from: ~sauter/public/ACTORS/4.09a)</p>
<p>Inputs:</p>
<ul class="simple">
<li><p>Equilibrium_in : input cpo</p></li>
<li><p>COCOS_in : COCOS of the input equilibrium (if the COCOS is not stored in
Equilibrium_in)</p></li>
<li><p>COCOS_out : Requested COCOS for the Equilibrium_out</p></li>
<li><p>Ipsign_out : Requested sign for output Ip; -9 if just wants IP_in
transformed to new equilibrium, +1 or -1 if a specific sign in output is
desired</p></li>
<li><p>B0sign_out : Requested sign for output B0</p></li>
</ul>
<p>Output:</p>
<ul class="simple">
<li><p>Equilibrium_out : Output cpo</p></li>
</ul>
</div>
</div>
<div class="section" id="the-flux-surface-average">
<span id="itm-conventions-flux-surface-average"></span><h3><span class="section-number">8.2.7. </span>The Flux Surface Average<a class="headerlink" href="#the-flux-surface-average" title="Permalink to this headline">¶</a></h3>
<p>In general, the flux surface average is the operation which annihilates the
magnetic derivative <span class="math notranslate nohighlight">\({\bf B} \cdot \nabla\)</span> and acts as an identity
operator on any flux quantity. It can be proved that this results in a
volume derivative of a volume integral (alternatively one starts with the
latter property and then proves the former, as the above Ciemat reference
does). The flux surface average of a scalar and divergence of a vector are
given by</p>
<div class="math notranslate nohighlight">
\[\langle G \rangle = \frac {\partial} {\partial V} \oint d^3V G \qquad \qquad \langle \nabla \cdot {\bf G} \rangle = \frac {\partial} {\partial V} \langle {\bf G}\cdot\nabla V \rangle\]</div>
<p>where <span class="math notranslate nohighlight">\({\bf G} \cdot \nabla V\)</span> is the contravariant volume
component of the vector <span class="math notranslate nohighlight">\({\bf G}\)</span>. It follows that the flux surface
average is an angle average weighted by the volume element <span class="math notranslate nohighlight">\(\sqrt{g}\)</span></p>
<div class="math notranslate nohighlight">
\[\langle G \rangle = \oint d \phi \oint d \theta \sqrt{g} G \left / \oint d \phi \oint d \theta \sqrt{g} \right.\]</div>
<p>for any choice of toroidal and poloidal angle as well as radial
coordinates, where <span class="math notranslate nohighlight">\(g\)</span> is the determinant of the covariant metric
tensor components in those coordinates. Note in general <span class="math notranslate nohighlight">\(G\)</span> is not an
axisymmetric quantity so the integration is actually over both angles.</p>
<p>For more detail see the above references.</p>
</div>
<div class="section" id="the-toroidal-flux-radius-as-the-radial-coordinate">
<span id="itm-conventions-toroidal-flux-radius-as-the-radial-coordinate"></span><h3><span class="section-number">8.2.8. </span>The Toroidal Flux Radius as the Radial Coordinate<a class="headerlink" href="#the-toroidal-flux-radius-as-the-radial-coordinate" title="Permalink to this headline">¶</a></h3>
<p>The EU-IM-TF has decided to use the toroidal flux radius <span class="math notranslate nohighlight">\(\rho_{{ \rm tor}}\)</span> defined by</p>
<div class="math notranslate nohighlight">
\[\Phi = \pi B_0 \rho_{{ \rm tor}}^2\]</div>
<p>where <span class="math notranslate nohighlight">\(B_0\)</span> is the reference (vacuum) magnetic field value. Note that
<span class="math notranslate nohighlight">\(\rho_{{ \rm tor}}\)</span> is a positive quantity which has units of
meters. For several applications the volume radius <span class="math notranslate nohighlight">\(\rho_{{ \rm vol}}\)</span> is also used. It is a normalised radius going from 0 to 1 and is
defined as</p>
<div class="math notranslate nohighlight">
\[V = V_{{\rm LCFS}} \rho_{{ \rm vol}}^2\]</div>
<p>where LCFS refers to the last closed flux surface. Both should be defined
in the equilibrium CPO (as well as <span class="math notranslate nohighlight">\({ \tt volume} \equiv V\)</span> itself).</p>
</div>
<div class="section" id="toroidal-and-parallel-current">
<span id="itm-conventions-toroidal-and-parallel-current"></span><h3><span class="section-number">8.2.9. </span>Toroidal and Parallel Current<a class="headerlink" href="#toroidal-and-parallel-current" title="Permalink to this headline">¶</a></h3>
<p>These are not equivalent, despite the often-seen experimental practice of
considering them so. The toroidal current given in Amperes depends on some
convention applied to <span class="math notranslate nohighlight">\(J_{\phi}\)</span> given above, which is not a flux
quantity. The EU-IM-TF has decided on this definition of the toroidal
current as a flux quantity:</p>
<div class="math notranslate nohighlight">
\[{\tt jphi} \equiv \langle J^ \phi \rangle / \langle 1/R \rangle\]</div>
<p>This uses the contravariant toroidal component of <span class="math notranslate nohighlight">\(\bf J\)</span> which is a
pure divergence</p>
<div class="math notranslate nohighlight">
\[J^\phi = {\bf J} \cdot \nabla \phi = J_ \phi / R^2 = - \nabla \cdot (2 \pi \mu_0 R^2)^{-1} \nabla \Psi\]</div>
<p>Hence the flux surface average invokes the often-used quantity <span class="math notranslate nohighlight">\(\langle
g^{\rho \rho}/R^2 \rangle\)</span> in the form</p>
<div class="math notranslate nohighlight">
\[\langle J^\phi \rangle = - (2 \pi \mu_0)^{-1} \frac{1}{V'_\rho} \frac{ \partial}{ \partial \rho} V'_\rho \langle g^{ \rho \rho} / R^2 \rangle \frac{ \partial\Psi}{ \partial \rho}\]</div>
<p>Here,  <span class="math notranslate nohighlight">\(V'_\rho \equiv \partial V / \partial \rho_{{\rm tor}}\)</span>
explicitly using the toroidal flux radius as the radial coordinate.</p>
<p>The parallel current is different from this due to the finiteness of the
poloidal current and magnetic field. Generally the correction is <span class="math notranslate nohighlight">\(O( \epsilon^2 / q^2)\)</span> which is usually a few percent (but not in a
spherical tokamak). Using the representations for <span class="math notranslate nohighlight">\(\bf B\)</span> and <span class="math notranslate nohighlight">\(\bf J\)</span> given above we find</p>
<div class="math notranslate nohighlight">
\[{\bf J} \cdot{ \bf B} =-(2 \pi \mu_0)^{-1}\,F_{{ \rm dia}}^2 \nabla \cdot \frac{1}{F_{{\rm dia}} R^2} \nabla \Psi\]</div>
<p>Since <span class="math notranslate nohighlight">\(F_{{\rm dia}}\)</span> is a flux quantity the flux surface average
behaves as for <span class="math notranslate nohighlight">\({\tt jphi}\)</span> and we use a factor of <span class="math notranslate nohighlight">\(B_0\)</span> to
provide the correct units, yielding</p>
<div class="math notranslate nohighlight">
\[{\tt jparallel} \equiv -(2 \pi \mu_0 B_0)^{-1} \frac{F_{{ \rm dia}}^2}{V'_\rho} \frac{ \partial}{ \partial \rho} \frac{V'_\rho}{F_{{\rm dia}}} \langle g^{\rho\rho}/R^2 \rangle \frac{\partial\Psi}{\partial\rho}\]</div>
<p>This form has been chosen due to the natural use of the flux surface
average <span class="math notranslate nohighlight">\(\langle{\bf J} \cdot{ \bf B} \rangle\)</span> in neoclassical theory
and the magnetic flux diffusion equation (see the Hinton and Hazeltine
reference above).</p>
</div>
<div class="section" id="straight-field-line-coordinates">
<span id="itm-conventions-straight-field-line"></span><h3><span class="section-number">8.2.10. </span>Straight Field Line Coordinates<a class="headerlink" href="#straight-field-line-coordinates" title="Permalink to this headline">¶</a></h3>
<p>A variety of modules in the EU-IM-TF use straight field line coordinate
systems to represent the closed flux surface region. To guarantee
consistency with the definition of the poloidal flux and the magnetic field
representation given above, a standard definition of the coordinate volume
element follows. This is the same sense as the usage of the term “Jacobian”
in the CPOs (note many papers use the inverse volume element as the
“Jacobian” by contrast). Here, “straight field line coordinates” refers to
the use of the right-handed coordinate system <span class="math notranslate nohighlight">\((\Psi, \theta, \zeta)\)</span>
with the poloidal flux <span class="math notranslate nohighlight">\(\Psi\)</span>, the straight field line angle
<span class="math notranslate nohighlight">\(\theta\)</span>, and the toroidal angle <span class="math notranslate nohighlight">\(\zeta = - \phi\)</span>. Therefore,
<span class="math notranslate nohighlight">\(\theta\)</span> has the same orientation as the poloidal angle <span class="math notranslate nohighlight">\(\theta\)</span>
in toroidal coordinates, while the toroidal angle <span class="math notranslate nohighlight">\(\zeta\)</span> is in
the opposite direction of <span class="math notranslate nohighlight">\(\phi\)</span>. This is standard usage generally
in terms of “flux coordinates” (see Hazeltine and Meiss, above).</p>
<p>Note here that while the toroidal angle is the geometric one in the
orientation sense of flux coordinates, the poloidal angle is not
geometric. This results from the demand that the field lines be straight
in the coordinate plane <span class="math notranslate nohighlight">\((\theta, \zeta)\)</span>. The definition of this
property is given by the specification of the ratio of contravariant
components of the magnetic field as a flux quantity, which is one and
the same with the pitch parameter (“local safety factor”):</p>
<div class="math notranslate nohighlight">
\[q = q(\Psi) = - B^ \zeta / B^\theta = B^\phi / B^\theta\]</div>
<p>where the minus sign appears by consistency with the primary definition in
terms of the flux components as given above. This represents a magnetic
differential equation for the poloidal angle:</p>
<div class="math notranslate nohighlight">
\[B^ \theta = B^ \phi / q  = F_{{\rm dia}}/qR^2\]</div>
<p>Due to the choice of “natural” coordinates (with <span class="math notranslate nohighlight">\(\Psi\)</span>, not <span class="math notranslate nohighlight">\(\rho_{{\rm tor}}\)</span>) this relation is close to the definition of the volume element <span class="math notranslate nohighlight">\(\sqrt{g}\)</span> and, equivalently, the Jacobian <span class="math notranslate nohighlight">\(J\)</span></p>
<div class="math notranslate nohighlight">
\[J \equiv \sqrt{g} \qquad \qquad J^{-1} = {\bf \nabla} \Psi \cdot {\bf \nabla} \theta \times {\bf \nabla} \zeta = {\bf \nabla} \Psi \times {\bf \nabla} \phi \cdot {\bf \nabla}\theta\]</div>
<p>Note the ordering of <span class="math notranslate nohighlight">\({\bf \nabla} \Psi\)</span> and <span class="math notranslate nohighlight">\({\bf \nabla} \phi\)</span>.</p>
<p>The components of the magnetic field are then</p>
<div class="math notranslate nohighlight">
\[\begin{split}B^{\theta} &amp;= {\bf B} \cdot {\bf \nabla} \theta = (2\pi)^{-1} {\bf \nabla} \Psi \times {\bf \nabla} \phi \cdot {\bf \nabla} \theta = (2\pi J)^{-1} \\
B^{\zeta} &amp;= {\bf B} \cdot {\bf \nabla} \zeta = - B_\phi/R^{2} = - F_{{\rm dia}}/R^{2}\\
B^{\Psi} &amp;= {\bf B} \cdot {\bf \nabla} \Psi = 0\end{split}\]</div>
<p>With these relations the following relationship between the Jacobian and pitch parameter (“local safety factor”) holds</p>
<div class="math notranslate nohighlight">
\[J = (2\pi)^{-1}q R^{2}/F_{{\rm dia}}\]</div>
<p>This is the quantity labelled <span class="math notranslate nohighlight">\({\tt jacobian}\)</span> in the equilibrium
CPO.</p>
</div>
<div class="section" id="plasma-betas">
<span id="itm-conventions-plasma-betas"></span><h3><span class="section-number">8.2.11. </span>Plasma Betas<a class="headerlink" href="#plasma-betas" title="Permalink to this headline">¶</a></h3>
<p>Out of the many definitions of plasma betas, the EU-IM has agreed to
adhere to the following definitions: Following Wesson (p. 116), the
poloidal beta is defined as an integral over the poloidal cross section</p>
<div class="math notranslate nohighlight">
\[\beta_{\rm p} = \frac{2 \mu_{0}} {B_{ \rm a}^{2}} \frac{ \int_{A} p \rm{d}S}{ \int_{A} \rm{d}S}\]</div>
<p>where <span class="math notranslate nohighlight">\(A = A (\Psi)\)</span> is the poloidal cross section enclosed by the
flux surface <span class="math notranslate nohighlight">\(\Psi\)</span>, <span class="math notranslate nohighlight">\(B_{\rm a} = \frac{ \mu_{0} I}{l}\)</span> is
the flux surface averaged poloidal magnetic field, <span class="math notranslate nohighlight">\(I = I( \Psi )\)</span> the toroidal plasma current inside the flux surface <span class="math notranslate nohighlight">\(\Psi\)</span> and <span class="math notranslate nohighlight">\(l = \oint \rm{d} l\)</span> the length of the poloidal perimeter of flux surface <span class="math notranslate nohighlight">\(\Psi\)</span>. This definition yields a one-dimensional profile <span class="math notranslate nohighlight">\(\beta_{\rm p} = \beta_{\rm p} ( \Psi )\)</span> stored in profiles_1d%beta_pol in the equilibrium CPO. The overall poloidal beta <span class="math notranslate nohighlight">\(\beta_{\rm p} (\Psi = \Psi_{\rm bd})\)</span> is stored in global_param%beta_pol.</p>
<p>The toroidal beta is defined as</p>
<div class="math notranslate nohighlight">
\[\beta_{\rm tor} = \frac{2 \mu_{0}}{B_{0}^{2}} \frac {\int_{\Omega} p \rm{d}V}{\int_{\Omega} \rm{d}V}\]</div>
<p>with <span class="math notranslate nohighlight">\(B_{0}\)</span> the vacuum magnetic field as stored in global_param%toroid_field%b0. The integral is carried out over the entire plasma volume and the result stored in global_param%beta_tor.</p>
<p>The normalized plasma beta is defined as</p>
<div class="math notranslate nohighlight">
\[\beta_{\rm N} = 100 \frac{a B_{0}}{10^{-6}I_{\rm p}} \beta_{\rm tor}\]</div>
<p>with <span class="math notranslate nohighlight">\(I_{\rm p}\)</span> the total plasma current (following Y.-S. Na et al.,
PPCF 44 (2002), 1285) and a is the minor radius. It is stored in
global_param%beta_normal.</p>
</div>
<div class="section" id="internal-inductance">
<span id="itm-conventions-internal-inductance"></span><h3><span class="section-number">8.2.12. </span>Internal Inductance<a class="headerlink" href="#internal-inductance" title="Permalink to this headline">¶</a></h3>
<p>The definition of the internal inductance follows J.A. Romero et al., NF 50
(2010), 115002. The magnetic energy contained inside the flux surface
<span class="math notranslate nohighlight">\(\Psi\)</span> is</p>
<div class="math notranslate nohighlight">
\[W_{\rm mag} = \frac{1}{2 \mu_{0}} \int_{\Omega} B_{\rm p}^{2} \rm{d}V\]</div>
<p>where <span class="math notranslate nohighlight">\(B_{\rm p}\)</span> is the poloidal component of the magnetic field. The (unnormalized) internal inductance is then defined as</p>
<div class="math notranslate nohighlight">
\[L_{\rm i} = \frac{2 W_{\rm mag}}{I^{2}}\]</div>
<p>where <span class="math notranslate nohighlight">\(I = I(\Psi)\)</span> is the toroidal plasma current enclosed by the
flux surface <span class="math notranslate nohighlight">\(\Psi\)</span>. The normalized internal inductance, as
stored in profiles_1d%li is defined as</p>
<div class="math notranslate nohighlight">
\[l_{\rm i} = \frac{2 L_{\rm i}}{\mu_{0} \bar{R}}\]</div>
<p>with the surface averaged major radius</p>
<div class="math notranslate nohighlight">
\[bar{R} = \frac{\int_{A} R \rm{d} S}{\int_{A} \rm{d}S} = \frac{V(\Psi)}{2 \pi A(\Psi)}\]</div>
<p>The overall internal inductance <span class="math notranslate nohighlight">\(l_{\rm i} (\Psi = \Psi_{\rm bd})\)</span> is stored in global_param%li.</p>
</div>
<div class="section" id="poloidal-angle-dimension-in-equilibrium-cpo">
<span id="itm-conventions-poloidal-angle-dimension-in-equilibrium-cpo"></span><h3><span class="section-number">8.2.13. </span>Poloidal Angle Dimension in Equilibrium CPO<a class="headerlink" href="#poloidal-angle-dimension-in-equilibrium-cpo" title="Permalink to this headline">¶</a></h3>
<p>The following entries in the equilibrium CPO are defined along the
poloidal dimension (as dim2 in the case of a flux surface equilibrium,
i.e. radial coordinate psi in dim1 and poloidal angle in dim2):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">coord_sys%jacobian(:,:)</span>
<span class="go">coord_sys%g_11(:,:)</span>
<span class="go">coord_sys%g_12(:,:)</span>
<span class="go">coord_sys%g_13(:,:)</span>
<span class="go">coord_sys%g_22(:,:)</span>
<span class="go">coord_sys%g_23(:,:)</span>
<span class="go">coord_sys%g_33(:,:)</span>
<span class="go">profiles_2d%position</span>
<span class="go">profiles_2d%grid</span>
<span class="go">profiles_2d%psi_grid(:,:)</span>
<span class="go">profiles_2d%jphi_grid(:,:)</span>
<span class="go">profiles_2d%jpar_grid(:,:)</span>
<span class="go">profiles_2d%br(:,:)</span>
<span class="go">profiles_2d%bz(:,:)</span>
<span class="go">profiles_2d%bphi(:,:)</span>
</pre></div>
</div>
<p>The EU-IM-TF has decided not to repeat the first poloidal point (with
poloidal angle <span class="math notranslate nohighlight">\(\theta = 0\)</span>, which is identical to
<span class="math notranslate nohighlight">\(\theta = 2 \pi\)</span>. This option was chosen to facilitate Fourier transforms along the
poloidal direction. To that purpose it is required that the dimension dim2
be equidistant in the poloidal angle <span class="math notranslate nohighlight">\(\theta\)</span> (going from <span class="math notranslate nohighlight">\(\theta =
0\)</span> to <span class="math notranslate nohighlight">\(\theta = (ndim2-1)/ndim2*2 \pi\)</span> where ndim2 is the number of
poloidal grid points), whatever the choice of this angle is.</p>
</div>
</div>
<div class="section" id="numerical-and-computational-conventions">
<span id="id2"></span><h2><span class="section-number">8.3. </span>Numerical and computational conventions<a class="headerlink" href="#numerical-and-computational-conventions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="standardized-variable-types">
<span id="itm-conventions-standardized-variable-types"></span><h3><span class="section-number">8.3.1. </span>Standardized Variable Types<a class="headerlink" href="#standardized-variable-types" title="Permalink to this headline">¶</a></h3>
<p>To ensure that physics modules produce identical results on various
computer architectures and to avoid issues with double precision versus
single precision interfaces, the EU-IM-TF has agreed on a set of
standardized variable types.
It is recommended that these types be used throughout all EU-IM modules,
but at least for the interface definitions.
The Fortran90 module defining the type standards
itm_types.f90
is hosted by the project
itmshared
.
To check out the relevant files please do</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">svn checkout https://gforge6.eufus.eu/svn/itmshared/trunk/src/itm_types target_dir</span>
</pre></div>
</div>
<p>For Fortran90, the following standard types have been defined</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">INTEGER,  PARAMETER :: EU-IM_I1 = SELECTED_INT_KIND (2)        ! Integer*1</span>
<span class="go">INTEGER,  PARAMETER :: EU-IM_I2 = SELECTED_INT_KIND (4)        ! Integer*2</span>
<span class="go">INTEGER,  PARAMETER :: EU-IM_I4 = SELECTED_INT_KIND (9)        ! Integer*4</span>
<span class="go">INTEGER,  PARAMETER :: EU-IM_I8 = SELECTED_INT_KIND (18)       ! Integer*8</span>
<span class="go">INTEGER,  PARAMETER :: R4 = SELECTED_REAL_KIND (6, 37)   ! Real*4</span>
<span class="go">INTEGER,  PARAMETER :: R8 = SELECTED_REAL_KIND (15, 300) ! Real*8</span>
</pre></div>
</div>
<p>To implement these types in your code, please add the following line to
your modules</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">use itm_types</span>
</pre></div>
</div>
<p>(More information about the EU-IM libraries.)</p>
</div>
<div class="section" id="standardized-physical-constants">
<span id="itm-conventions-standardized-physical-constants"></span><h3><span class="section-number">8.3.2. </span>Standardized Physical Constants<a class="headerlink" href="#standardized-physical-constants" title="Permalink to this headline">¶</a></h3>
<p>To avoid discrepancies in simulations from using different definitions of
the physical constants, the EU-IM-TF has agreed upon a set of standardized
physical constants (all in SI units except for temperatures) based on the
NIST recommendations . It is recommended that these constant be used
throughout all EU-IM modules. The Fortran90 module defining the
standardized physical constants itm_constants.f90 is hosted by the project
itmshared . To check out the relevant files please do</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">svn checkout https://gforge6.eufus.eu/svn/itmshared/trunk/src/itm_constants target_dir</span>
</pre></div>
</div>
</div>
<div class="section" id="invalid-data-base-entries">
<span id="itm-conventions-invalid-data-base-entries"></span><h3><span class="section-number">8.3.3. </span>Invalid Data Base Entries<a class="headerlink" href="#invalid-data-base-entries" title="Permalink to this headline">¶</a></h3>
<p>The EU-IM data base does not allow for setting data base entries directly
to invalid in case they should not be set. Since the Universal Access Layer
(UAL) always pulls out complete CPOs, i.e. complete data structures, of
which not all fields may be filled, the problem arose of how to identify
those fields which have not been filled. In the case of arrays, this is
simply done by not associating the corresponding pointer. In the case of
scalars, however, unique values for floats and integers had to be defined
to identify empty fields. These values identify invalid data base entries
and can be tested through comparison. The values for invalid data base
entries in Fortran90 are defined below:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">INTEGER,  PARAMETER :: itm_int_invalid = -999999999</span>
<span class="go">REAL(R8), PARAMETER :: itm_r8_invalid = -9.0D40</span>
</pre></div>
</div>
<p>They have been found to be safely out of any physical range for the
affected fields such that no accidental confusion with real values may
occur. The Fortran90 module defining these values itm_types.f90 is hosted
by the project itmshared . To check out the relevant files please do</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">svn checkout https://gforge6.eufus.eu/svn/itmshared/trunk/src/itm_types target_dir</span>
</pre></div>
</div>
<p>The module also includes three functions of type boolean itm_is_valid_int4
, itm_is_valid_int8 , and itm_is_valid_real8 which are overloaded under the
interface itm_is_valid to check whether a data base entry has been filled.
Example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">if (itm_is_valid(equilibrium%global_param%i_plasma)) then</span>
<span class="go">  write(*, *) &#39;Plasma current Ip = &#39;, equilibrium%global_param%i_plasma</span>
<span class="go">end if</span>
</pre></div>
</div>
</div>
<div class="section" id="enumerated-datatypes-identifiers">
<span id="itm-conventions-enumerated-datatypes"></span><h3><span class="section-number">8.3.4. </span>Enumerated datatypes/Identifiers<a class="headerlink" href="#enumerated-datatypes-identifiers" title="Permalink to this headline">¶</a></h3>
<p>This section concerns how to specify the origin of data in certain types of
CPOs. The specification is performed using the datatype identifier. The
following specifies the conventions of the allowed enumerated datatypes.</p>
<ul class="simple">
<li><p>cocos_identifier.xml</p></li>
<li><p>coordinate_identifier.xml</p></li>
<li><p>coredelta_identifier.xml</p></li>
<li><p>coreneutral_identifier.xml</p></li>
<li><p>coresource_identifier.xml</p></li>
<li><p>coretransp_identifier.xml</p></li>
<li><p>distsource_identifier.xml</p></li>
<li><p>fast_particle_origin_identifier.xml</p></li>
<li><p>fast_thermal_filter_identifier.xml</p></li>
<li><p>fokker_planck_source_identifier.xml</p></li>
<li><p>pellet_shape_identifier.xml</p></li>
<li><p>species_reference_identifier.xml</p></li>
<li><p>wall_identifier.xml</p></li>
<li><p>wave_identifier.xml</p></li>
</ul>
<div class="section" id="example-how-to-fill-coresource-values-sourceid">
<h4><span class="section-number">8.3.4.1. </span>Example: How to fill coresource/values/sourceid<a class="headerlink" href="#example-how-to-fill-coresource-values-sourceid" title="Permalink to this headline">¶</a></h4>
<p>When filling in an enumerated datatype, like coresource/values/sourceid, it
is recomended to use the parameters and functions built into the fortran
modules associated with each such datatype. These modules are available as
part of the UAL package. As an examples we may include the
coresource_identifier:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">use coresource_identifier, only: fusion, get_type_name, get_type_description__ind</span>
</pre></div>
</div>
<p>Here the value of the integer-parameter fusion is the Flag for fusion
reactions in the <a class="reference external" href="#itm_enum_types__coresource_identifier">coresource_identifier</a> structure (i.e. fusion=5). Once
we know the Flag we may get the Id using the function
Id=get_type_name(Flag) and the Description using the function
Description=get_type_description__ind(Flag). These function are available
for every datatype.</p>
<p>Below you have an example of how to use these functions:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">program coresource_example use euitm_schemas, only: type_coresource use</span>
<span class="go">  coresource_identifier, only: fusion, get_type_name,</span>
<span class="go">  get_type_description__ind use write_structures, only: open_write_file,</span>
<span class="go">  write_cpo, close_write_file use deallocate_structures, only:</span>
<span class="go">  deallocate_cpo implicit none</span>

<span class="go">  type (type_coresource) :: coresource</span>
<span class="go">  integer :: idx, i</span>

<span class="go">  character*128 :: filename</span>
<span class="go">  integer :: shot, run</span>

<span class="go">  data filename / &amp;</span>
<span class="go">       &amp; &#39;coresource.cpo&#39; &amp;</span>
<span class="go">       &amp; /</span>

<span class="go">  allocate(coresource%values(1))</span>
<span class="go">  allocate(coresource%values(1)%sourceid%id(1))</span>
<span class="go">  allocate(coresource%values(1)%sourceid%description(1))</span>
<span class="go">  coresource%values(1)%sourceid%flag = fusion</span>
<span class="go">  coresource%values(1)%sourceid%id = get_type_name(fusion)</span>
<span class="go">  coresource%values(1)%sourceid%description =</span>
<span class="go">  get_type_description__ind(fusion)</span>

<span class="go">  call open_write_file(1, filename)</span>
<span class="go">  call write_cpo(coresource, &#39;coresource&#39;)</span>
<span class="go">  call close_write_file</span>

<span class="go">  call deallocate_cpo(coresource)</span>

<span class="go">end program coresource_example</span>
</pre></div>
</div>
<p>This example program, and similar examples for other enumerated
datatypes, are available in:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">https://gforge6.eufus.eu/svn/itmshared/trunk/src/itm_constants/examples</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="grid-types-in-equilibrium-cpo">
<span id="itm-conventions-grid-types-in-equilibrium-cpo"></span><h3><span class="section-number">8.3.5. </span>Grid Types in Equilibrium CPO<a class="headerlink" href="#grid-types-in-equilibrium-cpo" title="Permalink to this headline">¶</a></h3>
<p>Equilibria may be represented in a variety of different ways depending on
which EU-IM module has calculated them and which module shall use them. To
avoid ambiguity and to allow modules to check which type of equilibrium is
stored in the equilibrium CPO, a unique grid identifier is stored in
profiles_2d%grid_type. The grid identified currently consists of 4 strings
(at 132 chars) with the following structure (array indices in Fortran
notation):</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 39%" />
<col style="width: 61%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Position</p></th>
<th class="head"><p>Content</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>grid_type(1)</p></td>
<td><p>integer identifier for grid type</p></td>
</tr>
<tr class="row-odd"><td><p>grid_type(2)</p></td>
<td><p>string identifier for grid type</p></td>
</tr>
<tr class="row-even"><td><p>grid_type(3)</p></td>
<td><p>integer identifier for poloidal angle</p></td>
</tr>
<tr class="row-odd"><td><p>grid_type(4)</p></td>
<td><p>string identifier for poloidal angle</p></td>
</tr>
</tbody>
</table>
<div class="section" id="grid-type-identifier">
<span id="itm-conventions-grid-type-identifier"></span><h4><span class="section-number">8.3.5.1. </span>Grid Type Identifier<a class="headerlink" href="#grid-type-identifier" title="Permalink to this headline">¶</a></h4>
<p>The currently allowed values (integer and string) for the identifier of
the grid type are listed below:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 29%" />
<col style="width: 53%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Integer
Values</p></th>
<th class="head"><p>String Value</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>rectangular</p></td>
<td><p>Regular grid in <span class="math notranslate nohighlight">\((R,Z)\)</span>.
‘EFIT-like grid’</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>inverse</p></td>
<td><p>Regular grid in <span class="math notranslate nohighlight">\(\Psi,\theta\)</span>.
‘flux surface grid’.</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>irregular</p></td>
<td><div class="line-block">
<div class="line">Irregular grid. All fields in
profiles_2d are given as (ndim1,
1)</div>
<div class="line">degenerate 2D matrices, i.e.
as lists of vertices (for</div>
<div class="line">triangles or quadrilaterals).</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="section" id="poloidal-angle-identifier">
<span id="itm-conventions-poloidal-angle-identifier"></span><h5><span class="section-number">8.3.5.1.1. </span>Poloidal Angle Identifier<a class="headerlink" href="#poloidal-angle-identifier" title="Permalink to this headline">¶</a></h5>
<p>The currently allowed values (integer and string) for the identifier of
the poloidal angle are listed below:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 29%" />
<col style="width: 53%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Integer
Values</p></th>
<th class="head"><p>String Value</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>straight field
line</p></td>
<td><p>straight field line angle
<span class="math notranslate nohighlight">\(\theta\)</span> as defined in
Straight Field Line Coordinates</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>equal arc</p></td>
<td><p>Poloidal angle <span class="math notranslate nohighlight">\(\theta\)</span>
defined by equal arc lengths
along flux surfaces</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>polar</p></td>
<td><p>Poloidal angle <span class="math notranslate nohighlight">\(\theta\)</span> in
toroidal coordinates as defined
in  Coordinate
System</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section" id="standardized-eu-eu-im-plasma-bundle">
<span id="itm-conventions-plasma-bundle"></span><h3><span class="section-number">8.3.6. </span>Standardized EU-EU-IM Plasma Bundle<a class="headerlink" href="#standardized-eu-eu-im-plasma-bundle" title="Permalink to this headline">¶</a></h3>
<p>The EU-IM has agreed on a standardized way to bundle CPOs and control
parameters inside KEPLER.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 10%" />
<col style="width: 17%" />
<col style="width: 12%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p><em>Field names</em></p></th>
<th class="head"><p><em>Type</em></p></th>
<th class="head"><p><em>Description</em></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="3"><p>time</p></td>
<td><p>real</p></td>
<td><div class="line-block">
<div class="line">The synthetic time of the simulation,</div>
<div class="line">or for time-dependent workflows; the</div>
<div class="line">end of the present time step. For</div>
<div class="line">example, consider a time dependent</div>
<div class="line">workflows, where physics quantities</div>
<div class="line">are update one after the other. Thus,</div>
<div class="line">while the physics quantities are</div>
<div class="line">updated the various fields below</div>
<div class="line">(e.g. the CPOs) may be describe at</div>
<div class="line">different time points. In such</div>
<div class="line">workflows the this “time”-field</div>
<div class="line">describe the time at the end of the</div>
<div class="line">present time step. Units: (s)</div>
</div>
</td>
</tr>
<tr class="row-odd"><td rowspan="7"><p>CONTROL</p></td>
<td colspan="2"><p>tau</p></td>
<td><p>real</p></td>
<td><p>time-step (s)</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>tau_out</p></td>
<td><p>real</p></td>
<td><p>time interval for saving output (s)</p></td>
</tr>
<tr class="row-odd"><td rowspan="5"><p>ETS</p></td>
<td><p>amix</p></td>
<td><p>real</p></td>
<td><p>mixing factor</p></td>
</tr>
<tr class="row-even"><td><p>amix_tr</p></td>
<td><p>real</p></td>
<td><p>mixing factor for profiles</p></td>
</tr>
<tr class="row-odd"><td><p>sigma_source</p></td>
<td><p>integer</p></td>
<td><div class="line-block">
<div class="line">option for origin of plasma electrical</div>
<div class="line">conductivity: 0: plasma collisions;</div>
<div class="line">1: transport module; 2: source module</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>solver_type</p></td>
<td><p>integer</p></td>
<td><p>choice of numerical solver</p></td>
</tr>
<tr class="row-odd"><td><p>conv_rec</p></td>
<td><p>real</p></td>
<td><p>required fractional convergence</p></td>
</tr>
<tr class="row-even"><td rowspan="26"><p>CPOS</p></td>
<td rowspan="4"><p>MHD</p></td>
<td><p>equilibrium</p></td>
<td><p>cpo</p></td>
<td><p>see type and fortran descriptions</p></td>
</tr>
<tr class="row-odd"><td><p>toroidfield</p></td>
<td><p>cpo</p></td>
<td><p>see type and fortran descriptions</p></td>
</tr>
<tr class="row-even"><td><p>mhd</p></td>
<td><p>cpo</p></td>
<td><p>see type and fortran descriptions</p></td>
</tr>
<tr class="row-odd"><td><p>sawteeth</p></td>
<td><p>cpo</p></td>
<td><p>see type and fortran descriptions</p></td>
</tr>
<tr class="row-even"><td rowspan="9"><p>CORE</p></td>
<td><p>coreprof</p></td>
<td><p>cpo</p></td>
<td><p>see type and fortran descriptions</p></td>
</tr>
<tr class="row-odd"><td><p>coretransp</p></td>
<td><p>cpo</p></td>
<td><p>see type and fortran descriptions</p></td>
</tr>
<tr class="row-even"><td><p>coresource</p></td>
<td><p>cpo</p></td>
<td><p>see type and fortran descriptions</p></td>
</tr>
<tr class="row-odd"><td><p>coreimpur</p></td>
<td><p>cpo</p></td>
<td><p>see type and fortran descriptions</p></td>
</tr>
<tr class="row-even"><td><p>coreneutral</p></td>
<td><p>cpo</p></td>
<td><p>see type and fortran descriptions</p></td>
</tr>
<tr class="row-odd"><td><p>corefast</p></td>
<td><p>cpo</p></td>
<td><p>see type and fortran descriptions</p></td>
</tr>
<tr class="row-even"><td><p>coredelta</p></td>
<td><p>cpo</p></td>
<td><p>see type and fortran descriptions</p></td>
</tr>
<tr class="row-odd"><td><p>compositionc</p></td>
<td><p>cpo</p></td>
<td><p>see type and fortran descriptions</p></td>
</tr>
<tr class="row-even"><td><p>neoclassic</p></td>
<td><p>cpo</p></td>
<td><p>see type and fortran descriptions</p></td>
</tr>
<tr class="row-odd"><td><p>EDGE</p></td>
<td><p>edge</p></td>
<td><p>cpo</p></td>
<td><p>see type and fortran descriptions</p></td>
</tr>
<tr class="row-even"><td rowspan="3"><p>HCD</p></td>
<td><p>waves</p></td>
<td><p>cpo</p></td>
<td><p>see type and fortran descriptions</p></td>
</tr>
<tr class="row-odd"><td><p>distsource</p></td>
<td><p>cpo</p></td>
<td><p>see type and fortran descriptions</p></td>
</tr>
<tr class="row-even"><td><p>distribution</p></td>
<td><p>cpo</p></td>
<td><p>see type and fortran descriptions</p></td>
</tr>
<tr class="row-odd"><td rowspan="6"><p>MACH</p></td>
<td><p>vessel</p></td>
<td><p>cpo</p></td>
<td><p>see type and fortran descriptions</p></td>
</tr>
<tr class="row-even"><td><p>wall</p></td>
<td><p>cpo</p></td>
<td><p>see type and fortran descriptions</p></td>
</tr>
<tr class="row-odd"><td><p>nbi</p></td>
<td><p>cpo</p></td>
<td><p>see type and fortran descriptions</p></td>
</tr>
<tr class="row-even"><td><p>antennas</p></td>
<td><p>cpo</p></td>
<td><p>see type and fortran descriptions</p></td>
</tr>
<tr class="row-odd"><td><p>ironmodel</p></td>
<td><p>cpo</p></td>
<td><p>see type and fortran descriptions</p></td>
</tr>
<tr class="row-even"><td><p>pfsystems</p></td>
<td><p>cpo</p></td>
<td><p>see type and fortran descriptions</p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><p>DIAG</p></td>
<td><p>fusiondiag</p></td>
<td><p>cpo</p></td>
<td><p>see type and fortran descriptions</p></td>
</tr>
<tr class="row-even"><td><p>scenario</p></td>
<td><p>cpo</p></td>
<td><p>see type and fortran descriptions</p></td>
</tr>
<tr class="row-odd"><td><p>EVENTS</p></td>
<td><p>pellets</p></td>
<td><p>cpo</p></td>
<td><p>see type and fortran descriptions</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="amns.html" class="btn btn-neutral float-right" title="9. AMNS" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="codes.html" class="btn btn-neutral float-left" title="7. Codes" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2019, WPCD.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>