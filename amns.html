

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>9. AMNS &mdash; EUROfusion Integrated Modelling workflows 3.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="10. Additional resources" href="resources.html" />
    <link rel="prev" title="8. Conventions" href="conventions.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> EUROfusion Integrated Modelling workflows
          

          
            
            <img src="_static/wpcd_banner_new.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">1. Introduction to the EUROfusion Project Code Development for integrated modelling</a></li>
<li class="toctree-l1"><a class="reference internal" href="infrastructure.html">2. Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="ets.html">3. European Transport Simulator (ETS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="es.html">4. Equilibrium and MHD Stability workflow (EQSTABIL)</a></li>
<li class="toctree-l1"><a class="reference internal" href="eqreconstr.html">5. The EQRECONSTRUCT workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="turbulence.html">6. Turbulence with synthetic diagnostics workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="codes.html">7. Codes</a></li>
<li class="toctree-l1"><a class="reference internal" href="conventions.html">8. Conventions</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">9. AMNS</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#scientific-rationale-and-main-objectives">9.1. Scientific Rationale and Main Objectives</a></li>
<li class="toctree-l2"><a class="reference internal" href="#eu-im-contact-person">9.2. EU-IM contact person</a></li>
<li class="toctree-l2"><a class="reference internal" href="#amns-tasks">9.3. AMNS tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#amns-documentation">9.4. AMNS Documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#amns-user-interface">9.4.1. AMNS User Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#amns-user-interface-data-structures">9.4.1.1. AMNS User Interface Data Structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="#amns-user-interface-data-reactions">9.4.1.2. AMNS User Interface Data Reactions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#amns-user-interface-data-queries">9.4.1.3. AMNS User Interface Data Queries</a></li>
<li class="toctree-l4"><a class="reference internal" href="#amns-user-interface-data-setting-options">9.4.1.4. AMNS User Interface Data Setting Options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fortran-amns-user-interface">9.4.1.5. FORTRAN AMNS User Interface</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#c-amns-user-interface">9.4.2. C AMNS User Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#amns-user-interface-c-calls">9.4.2.1. AMNS User Interface: C Calls</a></li>
<li class="toctree-l4"><a class="reference internal" href="#amns-user-interface-example-c">9.4.2.2. AMNS User Interface Example (C)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#amns-user-interface-example-c-makefile">9.4.2.3. AMNS User Interface Example C Makefile</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#python-amns-user-interface">9.4.3. Python AMNS User Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#amns-user-interface-python-calls">9.4.3.1. AMNS User Interface: Python Calls</a></li>
<li class="toctree-l4"><a class="reference internal" href="#amns-user-interface-example-python">9.4.3.2. AMNS User Interface Example (Python)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">10. Additional resources</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">EUROfusion Integrated Modelling workflows</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><span class="section-number">9. </span>AMNS</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/WPCD-Workflows/documentation/blob/master/source/amns.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="amns">
<h1><span class="section-number">9. </span>AMNS<a class="headerlink" href="#amns" title="Permalink to this headline">¶</a></h1>
<div class="section" id="scientific-rationale-and-main-objectives">
<h2><span class="section-number">9.1. </span>Scientific Rationale and Main Objectives<a class="headerlink" href="#scientific-rationale-and-main-objectives" title="Permalink to this headline">¶</a></h2>
<p>The EU-IM has a broad need for data relating to atomic, molecular, nuclear
and surface data (AMNS). In particular, AMNS data are needed in several
of the EU-IM modelling projects. A consistent approach, taking into
account the specific requirements of the EU-IM while maintaining the work
aligned with other European efforts in this area, is therefore required.</p>
</div>
<div class="section" id="eu-im-contact-person">
<h2><span class="section-number">9.2. </span>EU-IM contact person<a class="headerlink" href="#eu-im-contact-person" title="Permalink to this headline">¶</a></h2>
<p>David Coster</p>
</div>
<div class="section" id="amns-tasks">
<h2><span class="section-number">9.3. </span>AMNS tasks<a class="headerlink" href="#amns-tasks" title="Permalink to this headline">¶</a></h2>
<p>The AMNS work is divided into two broad areas:</p>
<ul class="simple">
<li><p>The maintenance and development of the AMNS library (and the
associated AMNS CPO) to provide access to AMNS data in the various
languages used by the codes within the Work Package</p></li>
<li><p>The addition to the AMNS database of AMNS data needed by the codes
within the Work Package</p></li>
</ul>
</div>
<div class="section" id="amns-documentation">
<span id="id1"></span><h2><span class="section-number">9.4. </span>AMNS Documentation<a class="headerlink" href="#amns-documentation" title="Permalink to this headline">¶</a></h2>
<p>The AMNS library is meant to be called by Work Package codes if the
codes need data for Atomic, Molecular, Nuclear or Surface processes. The
calling sequence is described in more detail below, but the basic idea
is: (1) initialize the package; (2) request data for a particular
reaction by initializing a “table” for that reaction; (3) (repeatedly)
requesting data for that reaction as a fuction of plasma or other
parameters; (4) finishing with the table; and (5) finishing with the
AMNS library.</p>
<p>The actual AMNS data is provided by CPOs stored under the “amns” tokamak
and will first be searched for in the user’s database, and if not found
there, the system will default to obtaining the data from the public
AMNS database. Multiple versions of the AMNS data are possible: in 4.09a
and 4.09b this was done via a mysql database; in 4.10a and 4.10b this is
done by having an index block stored in shot 0, run 1 of the AMNS CPO.</p>
<p>The implementation in IMAS IDS’s has followed the example of the CPO
implementation using shot 0, run 1 to store an index of available data.</p>
<p>Some papers:</p>
<ul class="simple">
<li><p>“Simulations of the edge plasma: the role of atomic, molecular and surface physics”,
AIP Conference Proceedings 1125, 113 (2009); <a class="reference external" href="https://doi.org/10.1063/1.3141685">https://doi.org/10.1063/1.3141685</a>,
D. P. Coster, X. Bonnin, D. Reiter, A. Kukushkin, S. Gori, P. Krstic, P. Strand,
L.‐G. Eriksson, and Contributors to the EFDA‐TF‐ITM</p></li>
<li><p>“Implementation of PIC/MC Code BIT1 in ITM Platform”, Contrib. Plasma Phys.,
54 (4-6), 399–403 (2014), <a class="reference external" href="https://doi.org/10.1002/ctpp.201410029">https://doi.org/10.1002/ctpp.201410029</a>,
D. Tskhakaya, D. Coster and ITM-TF contributors</p></li>
</ul>
<p>The present coding for the AMNS project is done in the gforge <a class="reference external" href="https://gforge6.eufus.eu/gf/project/amnsproto/">amnsproto
project</a>.</p>
<div class="section" id="amns-user-interface">
<span id="id2"></span><h3><span class="section-number">9.4.1. </span>AMNS User Interface<a class="headerlink" href="#amns-user-interface" title="Permalink to this headline">¶</a></h3>
<p>This section discusses the user interface to the AMNS subsystem.</p>
<p>The AMNS library is made available via a module - available versions can
be found by executing</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">module avail amns</span>
<span class="go">module avail AMNS</span>
</pre></div>
</div>
<p>The include and library locations are specified via the “pkg-config”
system. To display the available package names do</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">pkg-config --list-all | grep -i amns</span>
</pre></div>
</div>
<p>The AMNS library can be called from</p>
<ol class="arabic simple">
<li><p>Fortran</p></li>
<li><p>C /C++</p></li>
<li><p>Python</p></li>
<li><p>Java</p></li>
<li><p>Matlab</p></li>
</ol>
<p>The various bindings for the different languages are given below, but
make use of a set of standard concepts which are described first.</p>
<div class="section" id="amns-user-interface-data-structures">
<span id="id3"></span><h4><span class="section-number">9.4.1.1. </span>AMNS User Interface Data Structures<a class="headerlink" href="#amns-user-interface-data-structures" title="Permalink to this headline">¶</a></h4>
<p>A number of data structures are used by the library interface. Some are
opaque (i.e. the contents are not of relevance to the user), and some
need to be set or read by the user programme.</p>
<p>The two opaque types are handles which are returned by the setup
routines and then need to be passed to the other routines:</p>
<ol class="arabic simple">
<li><p>amns_handle_type, used for the database wide routines</p></li>
<li><p>amns_handle_rx_type, used for the reaction specific routines</p></li>
</ol>
<p>In some language bindings these are the basis of classes.</p>
<p>The non-opaque types are:</p>
<ol class="arabic simple">
<li><p>amns_error_type, used to indicate if an error occured and, if so,
what the error was</p></li>
<li><p>amns_reaction_type, used to indicate the requested reaction</p></li>
<li><p>amns_set_type, used to set an AMNS internal parameter</p></li>
<li><p>amns_query_type, used to query an AMNS internal parameter</p></li>
<li><p>amns_answer_type, used to contain the answer from an AMNS query</p></li>
<li><p>amns_version_type, used to specify the AMNS version</p></li>
<li><p>amns_reactants_type, used to specify the reactants to a reaction</p></li>
<li><p>amns_reactant_type, a sub-component of amns_reactants_type used to
characterize the individual reactants</p></li>
</ol>
<p>The definitions of these data types can be found at the <a class="reference external" href="https://portal.eufus.eu/documentation/EU-IM/doxygen/amns/amnsproto/User/4.10b/">doxygen
documentation for the AMNS User
routines</a></p>
</div>
<div class="section" id="amns-user-interface-data-reactions">
<span id="amns-user-interface-reactions"></span><h4><span class="section-number">9.4.1.2. </span>AMNS User Interface Data Reactions<a class="headerlink" href="#amns-user-interface-data-reactions" title="Permalink to this headline">¶</a></h4>
<p>The currently available reactions specified in reaction_typex%string in
the call to EU-IM_AMNS_SETUP_TABLE are</p>
<ol class="arabic simple">
<li><p>RC: Recombination (acd)</p></li>
<li><p>EI: Electron Impact Ionisation (scd)</p></li>
<li><p>CX: CX recombination coeffts (ccd)</p></li>
<li><p>BR: Recomb/brems power coeffts (prb)</p></li>
<li><p>LR: Line radiation (plt)</p></li>
<li><p>ZE: Effective Charge (zcd)</p></li>
<li><p>ZE2: Effective Square Charge (ycd)</p></li>
<li><p>EIP: Effective Ionisation Potential (ecd)</p></li>
<li><p>some nuclear reactions</p></li>
<li><p>Cross-sections of different processes</p></li>
<li><p>…</p></li>
</ol>
<p>The actual reactions are listed in the AMNS section.</p>
</div>
<div class="section" id="amns-user-interface-data-queries">
<span id="amns-user-interface-queries"></span><h4><span class="section-number">9.4.1.3. </span>AMNS User Interface Data Queries<a class="headerlink" href="#amns-user-interface-data-queries" title="Permalink to this headline">¶</a></h4>
<p>The currently available queries for query%string in the call to
EU-IM_AMNS_QUERY is</p>
<ol class="arabic simple">
<li><p>version: Return the version information</p></li>
</ol>
<p>The currently available queries for query%string in the call to
EU-IM_AMNS_QUERY_TABLE are</p>
<ol class="arabic simple">
<li><p>source: source (origin) of the data</p></li>
<li><p>no_of_reactants: number of tractants involved</p></li>
<li><p>index: Not sure what this is</p></li>
<li><p>filled: whether the data table has been filled (“Filled” or “Empty”)</p></li>
<li><p>reaction_type: reaction type</p></li>
<li><p>reactants: nuclear charges of reactants</p></li>
<li><p>version: information about the version</p></li>
<li><p>state_label: label for the charge state (if appropriate)</p></li>
<li><p>result_unit: units of the result</p></li>
<li><p>result_label: description of the result</p></li>
</ol>
</div>
<div class="section" id="amns-user-interface-data-setting-options">
<span id="amns-user-interface-settings"></span><h4><span class="section-number">9.4.1.4. </span>AMNS User Interface Data Setting Options<a class="headerlink" href="#amns-user-interface-data-setting-options" title="Permalink to this headline">¶</a></h4>
<p>The currently setting options for set%string in the call to EU-IM_AMNS_SET
is</p>
<ol class="arabic simple">
<li><p>NONE</p></li>
</ol>
<p>The currently available setting options for set%string in the call to
EU-IM_AMNS_SET_TABLE is</p>
<ol class="arabic simple">
<li><p>nowarn: deactivate warning when extrapolating</p></li>
</ol>
</div>
<div class="section" id="fortran-amns-user-interface">
<span id="amns-user-interface-f"></span><h4><span class="section-number">9.4.1.5. </span>FORTRAN AMNS User Interface<a class="headerlink" href="#fortran-amns-user-interface" title="Permalink to this headline">¶</a></h4>
<p>The fortran interface to the AMNS subsystem is based on a standardised
set of calls to the AMNS library. The details of what lies behind these
calls is the responsibility of the AMNS data providers and does not need
to be understood by the users of the AMNS data.</p>
<p>The code modules devloped for the AMNS project are hosted in gforge as
the <a class="reference external" href="https://gforge6.eufus.eu/gf/project/amnsproto/">project amnsproto</a>.</p>
<div class="section" id="amns-user-interface-fortran-calls">
<span id="amns-user-interface-calls-f"></span><h5><span class="section-number">9.4.1.5.1. </span>AMNS User Interface: Fortran Calls<a class="headerlink" href="#amns-user-interface-fortran-calls" title="Permalink to this headline">¶</a></h5>
<p>The 9 calls to the AMNS system are:</p>
<ol class="arabic simple">
<li><p>EU-IM_AMNS_SETUP, initialization call for the AMNS package</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">subroutine EU-IM_AMNS_SETUP(handle, version, error_status)</span>
<span class="go">  optional version, error_status</span>
<span class="go">  type(amns_handle_type), intent(out) :: handle</span>
<span class="go">  type(amns_version_type), intent(in) :: version</span>
<span class="go">  type(amns_error_type), intent(out) :: error_status</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>EU-IM_AMNS_QUERY, query routine for the AMNS package</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">subroutine EU-IM_AMNS_QUERY(handle,query,answer,error_status)</span>
<span class="go">  optional error_status</span>
<span class="go">  type(amns_handle_type), intent(in) :: handle</span>
<span class="go">  type(amns_query_type), intent(in) :: query</span>
<span class="go">  type(amns_answer_type), intent(out) :: answer</span>
<span class="go">  type(amns_error_type), intent(out) :: error_status</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>EU-IM_AMNS_SET, set a parameter for the AMNS package</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">subroutine EU-IM_AMNS_SET(handle,set,error_status)</span>
<span class="go">  optional error_status</span>
<span class="go">  type(amns_handle_type), intent(in) :: handle</span>
<span class="go">  type(amns_set_type), intent(in) :: set</span>
<span class="go">  type(amns_error_type), intent(out) :: error_status</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>EU-IM_AMNS_FINISH, finalization call for the AMNS package</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">subroutine EU-IM_AMNS_FINISH(handle, error_status)</span>
<span class="go">  optional error_status</span>
<span class="go">  type(amns_handle_type), intent(inout) :: handle</span>
<span class="go">  type(amns_error_type), intent(out) :: error_status</span>
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>EU-IM_AMNS_SETUP_TABLE, initialization call for a particular reaction</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">subroutine EU-IM_AMNS_SETUP_TABLE(handle, reaction_type, reactant, handle_rx, error_status)</span>
<span class="go">  optional error_status</span>
<span class="go">  type(amns_handle_type), intent(in) :: handle</span>
<span class="go">  type(amns_reaction_type), intent(in) :: reaction_type</span>
<span class="go">  type(amns_reactants_type), intent(in) :: reactant</span>
<span class="go">  type(amns_handle_rx_type), intent(out) :: handle_rx</span>
<span class="go">  type(amns_error_type), intent(out) :: error_status</span>
</pre></div>
</div>
<ol class="arabic" start="6">
<li><p>EU-IM_AMNS_QUERY_TABLE, query routine for a particular reaction</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">qsubroutine EU-IM_AMNS_QUERY_TABLE(handle_rx,query,answer,error_status)</span>
<span class="go">optional error_status type(amns_handle_rx_type), intent(in) ::</span>
<span class="go">handle_rx type(amns_query_type), intent(in) :: query</span>
<span class="go">type(amns_answer_type), intent(out) :: answer</span>
<span class="go">type(amns_error_type), intent(out) :: error_status</span>
</pre></div>
</div>
</li>
<li><p>EU-IM_AMNS_SET_TABLE, set a parameter for a particular reaction</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">subroutine EU-IM_AMNS_SET_TABLE(handle_rx,set,error_status)</span>
<span class="go">  optional error_status</span>
<span class="go">  type(amns_handle_rx_type), intent(in) :: handle_rx</span>
<span class="go">  type(amns_set_type), intent(in) :: set</span>
<span class="go">  type(amns_error_type), intent(out) :: error_status</span>
</pre></div>
</div>
<ol class="arabic simple" start="8">
<li><p>EU-IM_AMNS_FINISH_TABLE, finalization call for a particular reaction</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">subroutine EU-IM_AMNS_FINISH_TABLE(handle_rx, error_status)</span>
<span class="go">  optional error_status</span>
<span class="go">  type(amns_handle_rx_type), intent(inout) :: handle_rx</span>
<span class="go">  type(amns_error_type), intent(out) :: error_status</span>
</pre></div>
</div>
<ol class="arabic simple" start="9">
<li><p>EU-IM_AMNS_RX, get the rates associated with the input args for a
particular reaction</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">interface EU-IM_AMNS_RX</span>
<span class="go">  module procedure EU-IM_AMNS_RX_1, EU-IM_AMNS_RX_2, EU-IM_AMNS_RX_3</span>
<span class="go">end interface</span>

<span class="go">subroutine EU-IM_AMNS_RX_1(handle_rx,out,arg1,arg2,arg3,error_status)</span>
<span class="go">  optional arg2,arg3,error_status</span>
<span class="go">  type(amns_handle_rx_type), intent(inout) :: handle_rx</span>
<span class="go">  real (kind=R8), intent(out) :: out(:)</span>
<span class="go">  real (kind=R8), intent(in) :: arg1(:),arg2(:),arg3(:)</span>
<span class="go">  type(amns_error_type), intent(out) :: error_status</span>

<span class="go">subroutine EU-IM_AMNS_RX_2(handle_rx,out,arg1,arg2,arg3,error_status)</span>
<span class="go">  optional arg2,arg3,error_status</span>
<span class="go">  type(amns_handle_rx_type), intent(inout) :: handle_rx</span>
<span class="go">  real (kind=R8), intent(out) :: out(:,:)</span>
<span class="go">  real (kind=R8), intent(in) :: arg1(:,:),arg2(:,:),arg3(:,:)</span>
<span class="go">  type(amns_error_type), intent(out) :: error_status</span>

<span class="go">subroutine EU-IM_AMNS_RX_3(handle_rx,out,arg1,arg2,arg3,error_status)</span>
<span class="go">  optional arg2,arg3,error_status</span>
<span class="go">  type(amns_handle_rx_type), intent(inout) :: handle_rx</span>
<span class="go">  real (kind=R8), intent(out) :: out(:,:,:)</span>
<span class="go">  real (kind=R8), intent(in) :: arg1(:,:,:),arg2(:,:,:),arg3(:,:,:)</span>
<span class="go">  type(amns_error_type), intent(out) :: error_status</span>
</pre></div>
</div>
</div>
<div class="section" id="amns-user-interface-example-fortran">
<span id="amns-user-interface-example-f"></span><h5><span class="section-number">9.4.1.5.2. </span>AMNS User Interface Example (Fortran)<a class="headerlink" href="#amns-user-interface-example-fortran" title="Permalink to this headline">¶</a></h5>
<p>An example of the use of the code can be found in the (<a class="reference external" href="https://gforge6.eufus.eu/svn/amnsproto/tags/examples/fortran/">fortran minimal
example</a>):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">program minimal</span>
<span class="go">  use itm_types</span>
<span class="go">  use amns_types</span>
<span class="go">  use amns_module</span>

<span class="go">  implicit none</span>

<span class="go">  type (amns_handle_type) :: amns                            ! AMNS global handle</span>
<span class="go">  type (amns_handle_rx_type)  :: amns_rx                     ! AMNS table handle</span>
<span class="go">  type (amns_reaction_type) :: xx_rx</span>
<span class="go">  type (amns_reactants_type) :: species</span>
<span class="go">  real (kind=R8) :: te=100.0_R8, ne=1e20_R8, rate</span>

<span class="go">  call EU-IM_AMNS_SETUP(amns)                                  ! set up the AMNS system</span>
<span class="go">  allocate(species%components(4))                            ! set up reactants</span>
<span class="go">  species%components = (/ amns_reactant_type(6, 1, 12, 0), &amp;</span>
<span class="go">                          amns_reactant_type(1, 0, 2, 0), &amp;</span>
<span class="go">                          amns_reactant_type(6, 0, 12, 1), &amp;</span>
<span class="go">                          amns_reactant_type(1, 1, 2, 1) /)</span>
<span class="go">  xx_rx%string=&#39;CX&#39;                                          ! set up reaction</span>
<span class="go">  call EU-IM_AMNS_SETUP_TABLE(amns, xx_rx, species, amns_rx)   ! set up table</span>
<span class="go">  call EU-IM_AMNS_RX(amns_rx, rate, te, ne)                    ! get results</span>
<span class="go">  write(*,*) &#39;Rate = &#39;, rate</span>
<span class="go">  call EU-IM_AMNS_FINISH_TABLE(amns_rx)                        ! finish with table</span>
<span class="go">  call EU-IM_AMNS_FINISH(amns)                                 ! finish with amns</span>

<span class="go">end program minimal</span>
</pre></div>
</div>
</div>
<div class="section" id="amns-user-interface-example-fortran-makefile">
<span id="amns-user-interface-makefile-f"></span><h5><span class="section-number">9.4.1.5.3. </span>AMNS User Interface Example Fortran Makefile<a class="headerlink" href="#amns-user-interface-example-fortran-makefile" title="Permalink to this headline">¶</a></h5>
<p>An example Makefile demonstrating the use of the AMNS routines:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">obj/minimal: src/minimal.f90</span>
<span class="go">        ifort -g -o $@ $&lt; ${shell eval-pkg-config --cflags --libs \</span>
<span class="go">      amns-amd64_intel_12 itmtypes-amd64_intel_12 ual-amd64_intel_12}</span>
</pre></div>
</div>
<p>Other examples can be found
(<a class="reference external" href="https://gforge6.eufus.eu/svn/amnsproto/tags/examples/">here</a>):</p>
</div>
</div>
</div>
<div class="section" id="c-amns-user-interface">
<span id="amns-user-interface-c"></span><h3><span class="section-number">9.4.2. </span>C AMNS User Interface<a class="headerlink" href="#c-amns-user-interface" title="Permalink to this headline">¶</a></h3>
<p>The C interface to the AMNS subsystem is based on a standardised set of
calls to the AMNS library. The details of what lies behind these calls
is the responsibility of the AMNS data providers and does not need to be
understood by the users of the AMNS data.</p>
<p>The code modules devloped for the AMNS project are hosted in gforge as
the <a class="reference external" href="https://gforge6.eufus.eu/gf/project/amnsproto/">project amnsproto</a>.</p>
<div class="section" id="amns-user-interface-c-calls">
<span id="amns-user-interface-calls-c"></span><h4><span class="section-number">9.4.2.1. </span>AMNS User Interface: C Calls<a class="headerlink" href="#amns-user-interface-c-calls" title="Permalink to this headline">¶</a></h4>
<p>The 9 calls to the AMNS system are:</p>
<ol class="arabic simple">
<li><p>EU-IM_AMNS_SETUP, initialization call for the AMNS package</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">void EU-IM_AMNS_C_SETUP(void **handle_out, amns_error_type *error_status);</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>EU-IM_AMNS_QUERY, query routine for the AMNS package</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">void EU-IM_AMNS_C_QUERY(void *handle_in, amns_query_type *query,</span>
<span class="go">                      amns_answer_type *answer, amns_error_type *error_status)</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>EU-IM_AMNS_SET, set a parameter for the AMNS package</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">void EU-IM_AMNS_C_SET(void *handle_in, amns_set_type *set, amns_error_type *error_status);</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>EU-IM_AMNS_FINISH, finalization call for the AMNS package</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">void EU-IM_AMNS_C_FINISH(void **handle_inout, amns_error_type *error_status);</span>
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>EU-IM_AMNS_SETUP_TABLE, initialization call for a particular reaction</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">void EU-IM_AMNS_C_SETUP_TABLE(void *handle_in, amns_reaction_type *reaction_type,</span>
<span class="go">                            void *reactant_handle_in, void **handle_rx_out,</span>
<span class="go">                            amns_error_type *error_status);</span>
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li><p>EU-IM_AMNS_QUERY_TABLE, query routine for a particular reaction</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">void EU-IM_AMNS_C_QUERY_TABLE(void *handle_rx_in, amns_query_type *query,</span>
<span class="go">                            amns_answer_type *answer, amns_error_type *error_status);</span>
</pre></div>
</div>
<ol class="arabic simple" start="7">
<li><p>EU-IM_AMNS_SET_TABLE, set a parameter for a particular reaction</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">void EU-IM_AMNS_C_SET_TABLE(void *handle_rx_in, amns_set_type *set,</span>
<span class="go">                          amns_error_type *error_status);</span>
</pre></div>
</div>
<ol class="arabic simple" start="8">
<li><p>EU-IM_AMNS_FINISH_TABLE, finalization call for a particular reaction</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">void EU-IM_AMNS_C_FINISH_TABLE(void **handle_rx_inout, amns_error_type *error_status);</span>
</pre></div>
</div>
<ol class="arabic simple" start="9">
<li><p>EU-IM_AMNS_RX, get the rates associated with the input args for a
particular reaction</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">void EU-IM_AMNS_C_RX_0_A(void *handle_rx_in, double *out,</span>
<span class="go">                       double arg1, amns_error_type *error_status);</span>
<span class="go">void EU-IM_AMNS_C_RX_0_B(void *handle_rx_in, double *out,</span>
<span class="go">                       double arg1, double arg2, amns_error_type *error_status);</span>
<span class="go">void EU-IM_AMNS_C_RX_0_C(void *handle_rx_in, double *out,</span>
<span class="go">                       double arg1, double arg2, double arg3, amns_error_type *error_s</span>
<span class="go">tatus);</span>

<span class="go">void EU-IM_AMNS_C_RX_1_A(void *handle_rx_in, int nx, double *out,</span>
<span class="go">                       double *arg1, amns_error_type *error_status);</span>
<span class="go">void EU-IM_AMNS_C_RX_1_B(void *handle_rx_in, int nx, double *out,</span>
<span class="go">                       double *arg1, double *arg2, amns_error_type *error_status);</span>
<span class="go">void EU-IM_AMNS_C_RX_1_C(void *handle_rx_in, int nx, double *out,</span>
<span class="go">                       double *arg1, double *arg2, double *arg3, amns_error_ty</span>
<span class="go">pe *error_status);</span>

<span class="go">void EU-IM_AMNS_C_RX_2_A(void *handle_rx_in, int nx, int ny,</span>
<span class="go">                       double *out, double *arg1, amns_error_type *error_status);</span>
<span class="go">void EU-IM_AMNS_C_RX_2_B(void *handle_rx_in, int nx, int ny,</span>
<span class="go">                       double *out, double *arg1, double *arg2, amns_error_type *error_status);</span>
<span class="go">void EU-IM_AMNS_C_RX_2_C(void *handle_rx_in, int nx, int ny,</span>
<span class="go">                       double *out, double *arg1, double *arg2, double *arg3, amns_error_type *error_status);</span>

<span class="go">void EU-IM_AMNS_C_RX_3_A(void *handle_rx_in, int nx, int ny, int nz,</span>
<span class="go">                       double *out, double *arg1, amns_error_type *error_status);</span>
<span class="go">void EU-IM_AMNS_C_RX_3_B(void *handle_rx_in, int nx, int ny, int nz,</span>
<span class="go">                       double *out, double *arg1, double *arg2, amns_error_type *error_status);</span>
<span class="go">void EU-IM_AMNS_C_RX_3_C(void *handle_rx_in, int nx, int ny, int nz,</span>
<span class="go">                       double *out, double *arg1, double *arg2, double *arg3, amns_error_type *error_status);</span>
</pre></div>
</div>
<p>In addition, service routines are provided for dealing with reactants:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">void EU-IM_AMNS_C_SETUP_REACTANTS(void **reactants_handle_out, char string_in[reaction_length],</span>
<span class="go">                                int index_in, int n_react</span>
<span class="go">ants);</span>
<span class="go">void EU-IM_AMNS_C_SET_REACTANT(void *reactants_handle_in, int reactant_index, amns_reactant_type *reactant_in);</span>
<span class="go">void EU-IM_AMNS_C_GET_REACTANT(void *reactants_handle_in, int reactant_index, amns_reactant_type *reactant_out);</span>
<span class="go">void EU-IM_AMNS_C_FINISH_REACTANTS(void **reactants_handle_inout);</span>
</pre></div>
</div>
</div>
<div class="section" id="amns-user-interface-example-c">
<span id="id4"></span><h4><span class="section-number">9.4.2.2. </span>AMNS User Interface Example (C)<a class="headerlink" href="#amns-user-interface-example-c" title="Permalink to this headline">¶</a></h4>
<p>An example of the use of the code can be found in the (<a class="reference external" href="https://gforge6.eufus.eu/svn/amnsproto/tags/examples/c/">c minimal
example</a>):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span>include <span class="s2">&quot;amns_interface.h&quot;</span>

<span class="go">int main(int argc, char *argv[])</span>
<span class="go">{</span>
<span class="go">  void* amns_handle = NULL;</span>
<span class="go">  amns_c_error_type error_stat = DEFAULT_AMNS_C_ERROR_TYPE;</span>
<span class="go">  void* reactants_handle = NULL;</span>
<span class="go">  amns_c_reactant_type species1  = {.ZN=6, .ZA=1, .MI=12, .LR=0};</span>
<span class="go">  amns_c_reactant_type species2  = {.ZN=1, .ZA=0, .MI=2 , .LR=0};</span>
<span class="go">  amns_c_reactant_type species3  = {.ZN=6, .ZA=0, .MI=12, .LR=1};</span>
<span class="go">  amns_c_reactant_type species4  = {.ZN=1, .ZA=1, .MI=2 , .LR=1};</span>
<span class="go">  amns_c_reaction_type xx_rx  = {.string = &quot;CX&quot;};</span>
<span class="go">  void* amns_cx_handle;</span>
<span class="go">  double rate;</span>

<span class="go">  EU-IM_AMNS_CC_SETUP(AMNS_HANDLE, &amp;ERROR_STAT)</span>
<span class="go">  printf(&quot;error = %s: %s\n&quot;, error_stat.flag ? &quot;true&quot; : &quot;false&quot;, error_stat.string);</span>
<span class="go">  EU-IM_AMNS_CC_SETUP_REACTANTS(REACTANTS_HANDLE, &quot;&quot;, 0, 4)</span>
<span class="go">  EU-IM_AMNS_CC_SET_REACTANT(reactants_handle, 1, SPECIES1)</span>
<span class="go">  EU-IM_AMNS_CC_SET_REACTANT(reactants_handle, 2, SPECIES2)</span>
<span class="go">  EU-IM_AMNS_CC_SET_REACTANT(reactants_handle, 3, SPECIES3)</span>
<span class="go">  EU-IM_AMNS_CC_SET_REACTANT(reactants_handle, 4, SPECIES4)</span>
<span class="go">  EU-IM_AMNS_CC_SETUP_TABLE(amns_handle, XX_RX, REACTANTS_HANDLE, &amp;AMNS_CX_HANDLE, &amp;ERROR_STAT)</span>
<span class="go">  printf(&quot;error = %s: %s\n&quot;, error_stat.flag ? &quot;true&quot; : &quot;false&quot;, error_stat.string);</span>
<span class="go">  EU-IM_AMNS_CC_RX_0_B(amns_cx_handle, RATE, 100.0, 1E20, &amp;ERROR_STAT)</span>
<span class="go">  printf(&quot;error = %s: %s\n&quot;, error_stat.flag ? &quot;true&quot; : &quot;false&quot;, error_stat.string);</span>
<span class="go">  printf(&quot;rate=%e\n&quot;, rate);</span>
<span class="go">  EU-IM_AMNS_CC_FINISH_TABLE(AMNS_CX_HANDLE, &amp;ERROR_STAT)</span>
<span class="go">  printf(&quot;error = %s: %s\n&quot;, error_stat.flag ? &quot;true&quot; : &quot;false&quot;, error_stat.string);</span>
<span class="go">  EU-IM_AMNS_CC_FINISH_REACTANTS(REACTANTS_HANDLE)</span>
<span class="go">  EU-IM_AMNS_CC_FINISH(AMNS_HANDLE, &amp;ERROR_STAT)</span>
<span class="go">  printf(&quot;error = %s: %s\n&quot;, error_stat.flag ? &quot;true&quot; : &quot;false&quot;, error_stat.string);</span>
<span class="go">  return 0;</span>
<span class="go">}</span>
</pre></div>
</div>
</div>
<div class="section" id="amns-user-interface-example-c-makefile">
<span id="amns-user-interface-makefile-c"></span><h4><span class="section-number">9.4.2.3. </span>AMNS User Interface Example C Makefile<a class="headerlink" href="#amns-user-interface-example-c-makefile" title="Permalink to this headline">¶</a></h4>
<p>An example Makefile demonstrating the use of the AMNS routines:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">obj/minimal: src/minimal.c</span>
<span class="go">        gcc -g -o $@ $&lt; ${shell eval-pkg-config --cflags --libs\</span>
<span class="go">          amns-ifort itmconstants ual-amd64_intel_12}</span>
</pre></div>
</div>
<p>Other examples can be found
(<a class="reference external" href="https://gforge6.eufus.eu/svn/amnsproto/tags/examples/">here</a>):</p>
</div>
</div>
<div class="section" id="python-amns-user-interface">
<span id="amns-user-interface-python"></span><h3><span class="section-number">9.4.3. </span>Python AMNS User Interface<a class="headerlink" href="#python-amns-user-interface" title="Permalink to this headline">¶</a></h3>
<p>The Python interface to the AMNS subsystem is based on a standardised
set of calls to the AMNS library. The details of what lies behind these
calls is the responsibility of the AMNS data providers and does not need
to be understood by the users of the AMNS data.</p>
<p>The code modules devloped for the AMNS project are hosted in gforge as
the <a class="reference external" href="https://gforge6.eufus.eu/gf/project/amnsproto/">project amnsproto</a>.</p>
<div class="section" id="amns-user-interface-python-calls">
<span id="amns-user-interface-calls-python"></span><h4><span class="section-number">9.4.3.1. </span>AMNS User Interface: Python Calls<a class="headerlink" href="#amns-user-interface-python-calls" title="Permalink to this headline">¶</a></h4>
<p>The Python interface creates</p>
<ol class="arabic simple">
<li><p>Amns (class)</p>
<ol class="arabic simple">
<li><p>finalize (method)</p></li>
<li><p>get_table (method)</p></li>
<li><p>query (method)</p></li>
<li><p>set (method)</p></li>
</ol>
</li>
<li><p>Table (class)</p>
<ol class="arabic simple">
<li><p>data (method)</p></li>
<li><p>finalize (method)</p></li>
<li><p>query (method)</p></li>
<li><p>set (method)</p></li>
</ol>
</li>
<li><p>Reactants (class)</p>
<ol class="arabic simple">
<li><p>add (method)</p></li>
<li><p>test (method)</p></li>
<li><p>value (method)</p></li>
</ol>
</li>
</ol>
</div>
<div class="section" id="amns-user-interface-example-python">
<span id="id5"></span><h4><span class="section-number">9.4.3.2. </span>AMNS User Interface Example (Python)<a class="headerlink" href="#amns-user-interface-example-python" title="Permalink to this headline">¶</a></h4>
<p>An example of the use of the code can be found in the (<a class="reference external" href="https://gforge6.eufus.eu/svn/amnsproto/tags/examples/python/">python minimal
example</a>):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span>! /usr/bin/env python
<span class="gp"># </span>-*- coding: utf-8 -*-
<span class="go">import amns</span>
<span class="go">import numpy as np</span>

<span class="go">amnsdb = amns.Amns()</span>
<span class="go">r = amns.Reactants()</span>
<span class="go">r.add(6,1,12)</span>
<span class="go">r.add(1,0,2)</span>
<span class="go">r.add(6,0,12,lr=1)</span>
<span class="go">r.add(1,1,2,lr=1)</span>
<span class="go">table = amnsdb.get_table(&quot;CX&quot;, r)</span>
<span class="go">print &quot;table.no_of_reactants&quot;, table.no_of_reactants</span>
<span class="go">print table.data(np.array([100.0]), np.array([1e20]))</span>
<span class="go">amnsdb.finalize()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="resources.html" class="btn btn-neutral float-right" title="10. Additional resources" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="conventions.html" class="btn btn-neutral float-left" title="8. Conventions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2019, WPCD.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>