

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>3. European Transport Simulator (ETS) &mdash; EUROfusion Integrated Modelling workflows 3.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="4. Equilibrium and MHD Stability workflow (EQSTABIL)" href="es.html" />
    <link rel="prev" title="2. Infrastructure" href="infrastructure.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> EUROfusion Integrated Modelling workflows
          

          
            
            <img src="_static/wpcd_banner_new.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">1. Introduction to the EUROfusion Project Code Development for integrated modelling</a></li>
<li class="toctree-l1"><a class="reference internal" href="infrastructure.html">2. Infrastructure</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">3. European Transport Simulator (ETS)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#ets-documentation">3.1. ETS Documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#configuration-of-the-ets-5-workflow-in-kepler">3.1.1. Configuration of the ETS-5 workflow in Kepler</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ets-releases">3.1.2. ETS releases</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ets-workflows-in-kepler">3.2. ETS workflows in KEPLER</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#configuring-the-ets-run">3.2.1. Configuring the ETS run</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#workflow-parameters">3.2.1.1. Workflow parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ion-impurity-and-neutral-composition">3.2.1.2. Ion, Impurity and Neutral Composition</a></li>
<li class="toctree-l4"><a class="reference internal" href="#equations-to-be-solved-and-boundary-conditions">3.2.1.3. Equations to be solved and boundary conditions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#convergence-loop">3.2.1.4. Convergence loop</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ets-a-4-10b-equilibrium">3.2.1.5. Equilibrium</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ets-a-4-10b-transport">3.2.1.6. Transport</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mhd">3.2.1.7. MHD</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sources-and-impurity">3.2.1.8. Sources and impurity</a></li>
<li class="toctree-l4"><a class="reference internal" href="#instantaneous-events-actuators">3.2.1.9. Instantaneous events &amp; Actuators</a></li>
<li class="toctree-l4"><a class="reference internal" href="#scenario-output">3.2.1.10. Scenario output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#visualization-during-the-run">3.2.1.11. Visualization during the run</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#list-of-actors">3.2.2. List of Actors</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#equilibrium-actors">3.2.2.1. Equilibrium actors</a></li>
<li class="toctree-l4"><a class="reference internal" href="#core-transport-actors">3.2.2.2. Core transport actors</a></li>
<li class="toctree-l4"><a class="reference internal" href="#heating-and-current-drive-actors">3.2.2.3. Heating and current drive actors</a></li>
<li class="toctree-l4"><a class="reference internal" href="#events-actors">3.2.2.4. Events actors</a></li>
<li class="toctree-l4"><a class="reference internal" href="#non-physics-actors">3.2.2.5. Non-physics actors</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#turbulent-flux-quantities-in-transport-models">3.3. Turbulent Flux Quantities in Transport Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">3.3.1. Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#particle-flux-as-an-example">3.3.2. Particle Flux as an Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#metric-coefficients">3.3.3. Metric Coefficients</a></li>
<li class="toctree-l3"><a class="reference internal" href="#heat-fluxes">3.3.4. Heat Fluxes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ds-and-vs-from-turbulence-codes-to-transport-solvers">3.3.5. Ds and Vs from Turbulence Codes to Transport Solvers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ambipolarity">3.3.6. Ambipolarity</a></li>
<li class="toctree-l3"><a class="reference internal" href="#statistical-character">3.3.7. Statistical Character</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#running-exponential-average">3.4. Running Exponential Average</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id4">3.4.1. Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#definition">3.4.2. Definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="#differential-equation">3.4.3. Differential Equation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#equivalence-to-past-time-convolution-integral">3.4.4. Equivalence to Past-Time Convolution Integral</a></li>
<li class="toctree-l3"><a class="reference internal" href="#notes">3.4.5. notes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="es.html">4. Equilibrium and MHD Stability workflow (EQSTABIL)</a></li>
<li class="toctree-l1"><a class="reference internal" href="eqreconstr.html">5. The EQRECONSTRUCT workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="turbulence.html">6. Turbulence with synthetic diagnostics workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="codes.html">7. Codes</a></li>
<li class="toctree-l1"><a class="reference internal" href="conventions.html">8. Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="amns.html">9. AMNS</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">10. Additional resources</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">EUROfusion Integrated Modelling workflows</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><span class="section-number">3. </span>European Transport Simulator (ETS)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/WPCD-Workflows/documentation/blob/master/source/ets.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="european-transport-simulator-ets">
<h1><span class="section-number">3. </span>European Transport Simulator (ETS)<a class="headerlink" href="#european-transport-simulator-ets" title="Permalink to this headline">Â¶</a></h1>
<div class="section" id="ets-documentation">
<h2><span class="section-number">3.1. </span>ETS Documentation<a class="headerlink" href="#ets-documentation" title="Permalink to this headline">Â¶</a></h2>
<p>This page contains useful information on the European Transport Simulator (ETS) including documentation, description of the pre and post-processing tools used with ETS as well as instructions on how to use ETS and tools on the EUROfusion Gateway.</p>
<div class="section" id="configuration-of-the-ets-5-workflow-in-kepler">
<h3><span class="section-number">3.1.1. </span>Configuration of the ETS-5 workflow in Kepler<a class="headerlink" href="#configuration-of-the-ets-5-workflow-in-kepler" title="Permalink to this headline">Â¶</a></h3>
<p>ETS-5 uses CPO for actor integration in Kepler and as input data to the workflow. This means that the user environment
needs to be set up as ITM environment.</p>
<p><strong>To do so login on the EUROfusion Gateway and type the following commands:</strong></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">module purge</span>
<span class="go">module load cineca</span>
<span class="go">module load itmenv/ETS_4.10b.10_v5.7.0</span>
<span class="go">source $ITMSCRIPTDIR/ITMv2.sh jet</span>
<span class="go">export ITM_KEPLER_DIR=$ITMWORK/my_keplers</span>
<span class="go">export _JAVA_OPTIONS=&quot;-Xss20m -Xms4g -Xmx8g -Dsun.java2d.xrender=false&quot;</span>
</pre></div>
</div>
<p>The command âmodule load itmenv/ETSâ¦â loads the itmenv environment and in particular in the case above the ETS / Kepler version 5.7.0
To load a different version just change the number e.g. v5.5.0</p>
<p>The $ITMSCRIPTDIR/ITMv2.sh JET command will set up your local database folder to âJETâ. This means that any simulation done with ETS
will be saved in the JET folder (even if you are simulating TCV!!). If you would like to simulate any other Tokamak, type again the command and change JET with e.g. AUG.</p>
<p>The remaining commands are JAVA options for running Kepler and setting of MPI useful for running parallel actors.</p>
<p>If it is the first time you run ETS then you will need to install your first âdressedâ Kepler version which corresponds
to Kepler with all the WPCD actors embedded in it.</p>
<p><strong>This can be done by executing the following command</strong></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">install_kepler.sh ets_v570 trunk/ETS_4.10b.10_v5.7.0/central &quot;dressed central kepler v5.7.0&quot;</span>
<span class="go">switch_to_kepler.sh ets_v570</span>
</pre></div>
</div>
<p><strong>For loading the Workflow+tools (import data, postprocessing):</strong></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">svn co https://gforge6.eufus.eu/svn/keplerworkflows/tags/ETS_4.10b.10_v5.7.0</span>
</pre></div>
</div>
<p>The above command requires enabled access to GFORGE  (if you are a âsimpleâ user you might need to apply for access to GFORGE). Typing the command above will check out and store the ETS_worflow.xml and useful python scripts in the directory from where it is issued.</p>
<p><strong>Plotting routines such as kplots can be found under</strong></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&gt;cd $KEPLER</span>
</pre></div>
</div>
<p>You are now ready to start ETS!!</p>
<p><strong>The latest version of ETS-5 is v5.5.0 (09/12/2019)</strong></p>
<p>To launch Kepler and load the ETS-5 workflow just type</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&gt;kepler.sh</span>
</pre></div>
</div>
<p>or if you like to see the the log messages printed on the scree while ETS runs</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&gt;kepler.sh -nolog</span>
</pre></div>
</div>
<p>Once the Kepler canvas opens, chose the option âload workflowâ from the File menu and select the workflow
you would like to load. The recommendation is to use the ETS workflow released with the version release procedure and then upload your parameter settings via the parameter file. See the option - running ETS with autoGui</p>
<p>A video showing how to run and set up ETS-5 can be viewed here</p>
<p><a class="reference external" href="https://www.youtube.com/watch?v=dv427_XOFf4&amp;t=87s">https://www.youtube.com/watch?v=dv427_XOFf4&amp;t=87s</a></p>
</div>
<div class="section" id="ets-releases">
<h3><span class="section-number">3.1.2. </span>ETS releases<a class="headerlink" href="#ets-releases" title="Permalink to this headline">Â¶</a></h3>
<p>ETS release 5.5.0 is installed on the Gateway.</p>
<p>Quick installation instructions (to update your environment) are available here (password protected areas):</p>
<p><a class="reference external" href="https://portal.eufus.eu/twiki/bin/view/Main/Installation_of_latest_kepler_release">https://portal.eufus.eu/twiki/bin/view/Main/Installation_of_latest_kepler_release</a></p>
<p>Detailed instructions are available here:</p>
<p><a class="reference external" href="https://portal.eufus.eu/twiki/bin/view/Main/User_Guide_accessing_JET_data">https://portal.eufus.eu/twiki/bin/view/Main/User_Guide_accessing_JET_data</a></p>
<p>List of modifications (as compared to the previous release) is available here:</p>
<p><a class="reference external" href="https://portal.eufus.eu/twiki/bin/view/Main/Updates_550">https://portal.eufus.eu/twiki/bin/view/Main/Updates_550</a></p>
</div>
</div>
<div class="section" id="ets-workflows-in-kepler">
<h2><span class="section-number">3.2. </span>ETS workflows in KEPLER<a class="headerlink" href="#ets-workflows-in-kepler" title="Permalink to this headline">Â¶</a></h2>
<p>The ETS workflow is used for 1-D transport simulation of a tokamak core
plasma.</p>
<p><strong>ETS workflows in KEPLER</strong>:</p>
<ul class="simple">
<li><p>use actors and composite actors from the WPCD / IMAS fusion library</p></li>
<li><p>complex, but clearly structured workflow, which offers user friendly
interface for configuring the simulation</p></li>
<li><p>allow for easy modifications (connecting new modules, or reconnecting
parts of the workflow) through an easy graphical interface</p></li>
<li><p>provide users with all updates through the version control system</p></li>
<li><p>still in active development tool (ETS-6)</p></li>
</ul>
<p><strong>Starting the workflow:</strong>
If you have the workflow already installed, there are several
ways to execute it:</p>
<ul class="simple">
<li><p>For execution via kepler GUI:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&gt;kepler.sh workflow_path/workflow_name.xml</span>
</pre></div>
</div>
<ul class="simple">
<li><p>for executution via autoGui</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&gt;autoGui</span>
</pre></div>
</div>
<p>once the GUI opens select load workflow after which a parameter file can be loaded. You can create a parameter file by loading the standard
workflow released with the Kepler version and then chosing the option from the top menu âsave parameter fileâ.
The use of autoGui is strongly recommanded as worklows are large xml files while parameter files are small and do not take all your disk space. Moreover parameter files can be loaded in any version of ETS-5 by opening the standard workflow included in the release.</p>
<div class="figure align-center">
<img alt="_images/autoGui.png" src="_images/autoGui.png" />
</div>
<div class="section" id="configuring-the-ets-run">
<h3><span class="section-number">3.2.1. </span>Configuring the ETS run<a class="headerlink" href="#configuring-the-ets-run" title="Permalink to this headline">Â¶</a></h3>
<div class="section" id="workflow-parameters">
<span id="ets-a-4-10b-workflow-parameters"></span><h4><span class="section-number">3.2.1.1. </span>Workflow parameters<a class="headerlink" href="#workflow-parameters" title="Permalink to this headline">Â¶</a></h4>
<div class="section" id="general-parameters">
<h5><span class="section-number">3.2.1.1.1. </span>General Parameters<a class="headerlink" href="#general-parameters" title="Permalink to this headline">Â¶</a></h5>
<ul class="simple">
<li><p>USER
- your userid</p></li>
<li><p>MACHINE
- machine name (database name) for which comutations are done</p></li>
<li><p>SHOT_IN
- input shot number</p></li>
<li><p>RUN_IN
- input run number</p></li>
<li><p>RUN_OUT
- output run number</p></li>
<li><p>RUNWORK
- work directory number (typically 800)</p></li>
</ul>
</div>
<div class="section" id="time-resolution">
<h5><span class="section-number">3.2.1.1.2. </span>Time resolution<a class="headerlink" href="#time-resolution" title="Permalink to this headline">Â¶</a></h5>
<p><strong>Start and End time:</strong></p>
<ul class="simple">
<li><p>TBEGIN
- Computations start time</p></li>
<li><p>TEND
- Computations end time</p></li>
</ul>
</div>
<div class="section" id="transport">
<h5><span class="section-number">3.2.1.1.3. </span>Transport<a class="headerlink" href="#transport" title="Permalink to this headline">Â¶</a></h5>
<ul class="simple">
<li><p>NRHO
- number of radial points for transport equations</p></li>
</ul>
</div>
<div class="section" id="equilibrium">
<h5><span class="section-number">3.2.1.1.4. </span>Equilibrium<a class="headerlink" href="#equilibrium" title="Permalink to this headline">Â¶</a></h5>
<ul class="simple">
<li><p>NPSI
- number of points for equilibrium 1-D arrays</p></li>
<li><p>NEQ_DIM1
- number of points for equilibrium 2-D arrays, first index</p></li>
<li><p>NEQ_DIM2
- number of points for equilibrium 2-D arrays, second index</p></li>
<li><p>NEQ_MAX_NPOINTS
- maximum number of points for equilibrium boundary</p></li>
</ul>
</div>
<div class="section" id="numerics">
<h5><span class="section-number">3.2.1.1.5. </span>Numerics<a class="headerlink" href="#numerics" title="Permalink to this headline">Â¶</a></h5>
<ul class="simple">
<li><p>NUMERICAL_SOLVER
- choice of the numerics solving transport equations (RECOMENDED
SELECTION: 3 or 4)</p></li>
<li><p>EXPLICIT HYPER DIFFUSIVITY
- Constant diffusivity used in the stabilization scheme needed to deal with stiff transport models</p></li>
<li><p>IMPLICIT HYPER DIFFUSIVITY
- Same as above used in the implicit part of the solver</p></li>
<li><p>MINIMUM TIME STEP
-  Minimum time step allowed in the transport solver</p></li>
<li><p>MAXIMUM TIME STEP
- Maximum time step allowed in the transport solver</p></li>
</ul>
</div>
<div class="section" id="id1">
<h5><span class="section-number">3.2.1.1.6. </span>Equilibrium<a class="headerlink" href="#id1" title="Permalink to this headline">Â¶</a></h5>
<ul class="simple">
<li><p>NPSI
- number of points for equilibrium 1-D arrays</p></li>
<li><p>NEQ_DIM1
- number of points for equilibrium 2-D arrays, first index</p></li>
<li><p>NEQ_DIM2
- number of points for equilibrium 2-D arrays, second index</p></li>
<li><p>NEQ_MAX_NPOINTS
- maximum number of points for equilibrium boundary</p></li>
</ul>
<div class="figure align-center">
<img alt="_images/ETS_Main_Param.png" src="_images/ETS_Main_Param.png" />
</div>
<p><strong>Time step:</strong></p>
<ul class="simple">
<li><p>right click on the box
BEFORE THE TIME EVOLUTION</p></li>
<li><p>select
Configure actor</p></li>
<li><p>TAU
:specify value of the time step in [s]</p></li>
<li><p>TAU_OUT
: specify value of the output time interval in [s]</p></li>
<li><p>Commit</p></li>
</ul>
<div class="figure align-center">
<img alt="_images/ets_settings1.png" src="_images/ets_settings1.png" />
</div>
</div>
</div>
<div class="section" id="ion-impurity-and-neutral-composition">
<span id="ets-a-4-10b-composition"></span><h4><span class="section-number">3.2.1.2. </span>Ion, Impurity and Neutral Composition<a class="headerlink" href="#ion-impurity-and-neutral-composition" title="Permalink to this headline">Â¶</a></h4>
<p>Before starting the run you need to define types of main ions, impurity
(optional) and neutrals (optional) to be included in simulations.</p>
<p>To define plasma composition:</p>
<ul class="simple">
<li><p>right click on the box
BEFORE THE TIME EVOLUTION</p></li>
<li><p>select <strong>Configure actor</strong></p></li>
<li><p>choose one of modes for setting
Run_compositions</p>
<ul>
<li><p>from_input_CPO
- will pick up the COMPOSITIONS structure of the COREPROF CPO
saved to the input shot;</p></li>
<li><p>configure_manually
- will force the composition from the values specified below</p></li>
</ul>
</li>
<li><p>specify values of atomic mass (AMN_ion), nuclear charge ( ZN_ion ) and
charge ( Z_ion , from the first ion to the last [1:NION] , separated by
commas</p></li>
<li><p>(optional) specify values of atomic mass ( AMN_imp ), nuclear charge (
ZN_imp ) and maximal ionization state ( max_Z_imp ) for impurity ions,
from the first to the last [1:NIMP] , separated by commas</p></li>
<li><p>(optional)for neutrals activate, by switchen them to <strong>ON</strong>, the types which
shall be followed by neutral solver</p></li>
<li><p>press <strong>Commit</strong></p></li>
</ul>
<div class="figure align-center">
<img alt="_images/ets_plasma_composition.png" src="_images/ets_plasma_composition.png" />
</div>
</div>
<div class="section" id="equations-to-be-solved-and-boundary-conditions">
<span id="ets-a-4-10b-equations"></span><h4><span class="section-number">3.2.1.3. </span>Equations to be solved and boundary conditions<a class="headerlink" href="#equations-to-be-solved-and-boundary-conditions" title="Permalink to this headline">Â¶</a></h4>
<div class="section" id="main-plasma">
<h5><span class="section-number">3.2.1.3.1. </span>Main Plasma<a class="headerlink" href="#main-plasma" title="Permalink to this headline">Â¶</a></h5>
<p>Before starting the run you need to select the type and value of the
boundary conditions for all equations. Please note that the value should
correspond to the type. All equations allow for following types of
boundary conditions:</p>
<ul class="simple">
<li><p>OFF
- equation is not solved, initial profiles will be kept for whole run</p></li>
<li><p>value
- edge value should be specified</p></li>
<li><p>gradient
- edge gradient should be specified</p></li>
<li><p>scale_length
- edge scale length should be specified</p></li>
<li><p>generic
- generic form:
a1*yÂ´ + a2*y = a3
of the boundary condition is assumed, 3 coefficients (a1, a2, a3) should be provided</p></li>
<li><p>value_from_input_CPO
- equation is solved, edge value evolution will be red from input
shot</p></li>
<li><p>profile_from_input_CPO
- equation is not solved, profile evolution will be red from input
shot</p></li>
</ul>
<p>The particular equation will be activated if the boundary condition type
for it is other than <em>OFF</em></p>
<div class="figure align-center">
<img alt="_images/ets_run_settings3.png" src="_images/ets_run_settings3.png" />
</div>
<p>To set up boundary conditions:</p>
<ul class="simple">
<li><p>right click on the box BEFORE THE TIME EVOLUTION</p></li>
<li><p>select <strong>Configure actor</strong></p></li>
<li><p>select appropriate boundary condition for each equation</p></li>
<li><p>specify values for boundary conditions corresponding to the type and
to the ion component</p></li>
<li><p><strong>Commit</strong></p></li>
</ul>
<p>The workflow will not allow the user all particle components
(ions[1:NION]+electrons) to be run predictively. At least one of them shall
be set to OFF (this component will be computed from quasi-neutrality
condition).</p>
<p>!!! If electron density is solved, all ions with ni_bnd_type=OFF will be
computed from the quasineutrality condition and scaled proportional to
specified <em>ni_bnd_value</em> or inversely proportional to their charge,
<em>charge_proportional</em>. This is defined by option:
<em>ni_from_quasineutrality</em>.</p>
</div>
<div class="section" id="impurity">
<h5><span class="section-number">3.2.1.3.2. </span>Impurity<a class="headerlink" href="#impurity" title="Permalink to this headline">Â¶</a></h5>
<p>You can set up the boundary conditions for impurity ions in a similar
way as for main ions. !!! Note, that at the moment only types: <em>OFF</em>;
<em>value</em> and <em>value_from_input_CPO</em> are accepter by impurity solver.</p>
<p>To set up boundary conditions:</p>
<ul class="simple">
<li><p>right click on the box BEFORE THE TIME EVOLUTION</p></li>
<li><p>select <strong>Configure actor</strong></p></li>
<li><p>select appropriate boundary condition for each impurity species (
OFF-equation is not solved)</p></li>
<li><p>specify values for boundary density of each impurity component
[1:MAX_Z_IMP], separated by commas</p></li>
<li><p><strong>Commit</strong></p></li>
</ul>
<div class="figure align-center">
<img alt="_images/ets_run_settings4.png" src="_images/ets_run_settings4.png" />
</div>
<p>Interface for impurity boundary condition has additional option,
<em>coronal_distribution</em>, that allow to preset the edge values or entire
profiles of individual ionization states from coronal distribution. In tis
case only single value is required to be specified for each impurity
boundary value. The options are:</p>
<ul class="simple">
<li><p>OFF
- the boundary values for impurity densities will be as they are
specified above;</p></li>
<li><p>boundary_conditions
- the boundary densities will be renormalized with corona, using the
first element from above as a total density</p></li>
<li><p>boundary_conditions_and_profiles
- the boundary densities and starting profiles will be renormalized
with corona, using the first element from above as a total density</p></li>
</ul>
</div>
<div class="section" id="neutrals">
<h5><span class="section-number">3.2.1.3.3. </span>Neutrals<a class="headerlink" href="#neutrals" title="Permalink to this headline">Â¶</a></h5>
<p>Note, that ALL values should be specified in the order: {<em>1, 2, 3 â¦NION, 1, 2, 3, â¦NIMP</em>}</p>
<p>To set up boundary conditions:</p>
<ul class="simple">
<li><p>right click on the box BEFORE THE TIME EVOLUTION</p></li>
<li><p>select <strong>Configure actor</strong></p></li>
<li><p>select appropriate boundary condition for each neutral species (OFF-equation is not solved)</p></li>
<li><p>specify values for boundary density and temperature of each neutral component
[1, 2, 3 â¦NION, 1, 2, 3, â¦NIMP], separated by commas</p></li>
<li><p><strong>Commit</strong></p></li>
</ul>
<div class="figure align-center">
<img alt="_images/ets_run_settings5.png" src="_images/ets_run_settings5.png" />
</div>
</div>
<div class="section" id="input-profiles-interpolation">
<h5><span class="section-number">3.2.1.3.4. </span>Input profiles interpolation<a class="headerlink" href="#input-profiles-interpolation" title="Permalink to this headline">Â¶</a></h5>
<p>You are going to start the ETS run from some input shot, which might
contain some conflicting rho grids saved to different CPOs. Thus there is a
choice for the user to decide on the grid on which the starting profiles
should be load by the worflow,</p>
<p><em>Interpolation_of_input_profiles</em>.</p>
<p>To define the interpolation grid select:</p>
<ul class="simple">
<li><p>on_RHO_TOR_grid
- interpolate input profiles based on the grid specyfied in [m];</p></li>
<li><p>on_RHO_TOR_NORM_grid
- interpolate input profiles based on normalised rho grid [0:1]</p></li>
</ul>
<div class="figure align-center">
<img alt="_images/ets_run_settings6.png" src="_images/ets_run_settings6.png" />
</div>
</div>
</div>
<div class="section" id="convergence-loop">
<h4><span class="section-number">3.2.1.4. </span>Convergence loop<a class="headerlink" href="#convergence-loop" title="Permalink to this headline">Â¶</a></h4>
<p>ETS updates input from different physics actors in a sequence, which is
finished by solving the transport equations. Ther are possible
none-linear couplings between different parts of the system. These
nonelinearities are treated by the ETS using iterations. The decision to
step in time is made by the ETS based on the criteria that the maximum
relative deviation of main plasma profiles is lower than some predefined
tolerance. There is a number of settings and switches in the ETS that are
used by the iterative scheme. To edit them do:</p>
<ul class="simple">
<li><p>right click on the box CONVERGENCE LOOP</p></li>
<li><p>select <strong>Configure actor</strong> to edit settings</p></li>
<li><p>choose your settings</p></li>
<li><p><strong>Commit</strong></p></li>
</ul>
<div class="figure align-center">
<img alt="_images/Convergence_Loop.png" src="_images/Convergence_Loop.png" />
</div>
<p>Switches in the field <em>FREQUENCY OF CALLING THE PHYSICS ACTORS</em> define
how many times the actors of a certain cathegory (equilibrium,
transport, etc.) should be called.</p>
<p>Switches and parameters in the field <em>CONTROL PARAMETERS</em> define how
iterations are done</p>
<ul class="simple">
<li><p>Tolerance - defines the maximum relative error of profiles change compared to
previous iteration. If it is achieved the time steping is done.</p></li>
</ul>
<p>For highly none-linear case the required precision can be achieved
faster by the iterative scheme if only fraction of the new solution is
mixed to the previous state.
The following scheme is adopted by the ets to reduce none-linearities in profiles, transport coefficients and
sources:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Y = (Amix * Y+) + ((1-Amix)*Y-)</span>
</pre></div>
</div>
<p>where Amix is the mixing fraction You can activate the mixing of
profiles, transport coefficient and sources by selecting the
corresponding <em>Mixing_fraction_â¦</em> to be between [0:1]
You also can activate the authomatic ajustment of this fraction by selecting:
<em>Ajust_Mixing_for_â¦</em> to <em>YES</em></p>
</div>
<div class="section" id="ets-a-4-10b-equilibrium">
<span id="id2"></span><h4><span class="section-number">3.2.1.5. </span>Equilibrium<a class="headerlink" href="#ets-a-4-10b-equilibrium" title="Permalink to this headline">Â¶</a></h4>
<div class="section" id="initialization-settings">
<h5><span class="section-number">3.2.1.5.1. </span>Initialization Settings<a class="headerlink" href="#initialization-settings" title="Permalink to this headline">Â¶</a></h5>
<p>Before starting the run you need to set up your initial equlibrium.
There are several options to do it: if your input shot contains the
consistent equilibrium with all necessary parameters - you can start
immediately from it; if your input shot contains the equilibrium but it
is not consistent or some parameters are missing you can check it
automatically; if your input equilibrium is corrupt or not present - you
can define the starting equlinbrium by tree moment description. To
select your starting equilibrium please do:</p>
<ul class="simple">
<li><p>right click on the box BEFORE THE TIME EVOLUTION</p></li>
<li><p>select <strong>Configure actor</strong> to edit settings</p></li>
<li><p>Select your settings or specify values</p></li>
<li><p><strong>Commit</strong></p></li>
</ul>
<div class="figure align-center">
<img alt="_images/ets_before_time.png" src="_images/ets_before_time.png" />
</div>
<p>SETTINGS:</p>
<ul class="simple">
<li><p>Equilibrium_configuration
- select
configure_manually
if you like to specify configuration below; select
from_input_CPO
if all quantities should be picked up from the input CPO</p></li>
<li><p>R0_Machine_characteristic_radius
- Characteristic radius of the machine, here B0 is measured [m]</p></li>
<li><p>B0_Magnetic_field_at_R0
- Magnetic field measured at the position R0 [T]</p></li>
<li><p>RGEO_Major_Radius_of_LCMS_centre
- R coordinate of the geometrical centre of the LCMS [m]</p></li>
<li><p>ZGEO_Altitude_of_LCMS_centre
- Z coordinate of the geometrical centre of the LCMS [m]</p></li>
<li><p>Total_plasma_current_IP
- plasma current within the LCMS [A]</p></li>
<li><p>Minor_radius
- minor radius of the LCMS [m]</p></li>
<li><p>Elongation
- elongation of the LCMS [-]</p></li>
<li><p>Triangularity_upper
- upper triangularity of the LCMS [-]</p></li>
<li><p>Triangularity_lower
- lower triangularity of the LCMS [-]</p></li>
<li><p>Equilibrium code
- select one of available equilibrium solvers to check the
consistency between starting equilibrium and current profile; use
INTERPRETATIVE
if you trust your input data (in this case the check will be
ignorred).</p></li>
</ul>
<div class="figure align-center">
<img alt="_images/ets_run_settings7.png" src="_images/ets_run_settings7.png" />
</div>
<p>Please note, that different equilibrium solvers might require slightly
different input. Thus it is a user responsibility to check that the
information inside input shot/run is enough to run selected equilibrium
solver.</p>
</div>
<div class="section" id="run-settings">
<h5><span class="section-number">3.2.1.5.2. </span>Run Settings<a class="headerlink" href="#run-settings" title="Permalink to this headline">Â¶</a></h5>
<p>There are several equilibrium solvers connected to the ETS. You can
select the one of them.Therefore please do:</p>
<ul class="simple">
<li><p>right click on the box CONVERGENCE LOOP</p></li>
<li><p>select <strong>Open actor</strong></p></li>
<li><p>right click on the box EQUILIBRIUM</p></li>
<li><p>select <strong>Configure actor</strong> to edit settings</p></li>
<li><p>choose your equilibrium solver</p></li>
<li><p><strong>Commit</strong></p></li>
</ul>
<div class="figure align-center">
<img alt="_images/ets_convergence_loop_config.png" src="_images/ets_convergence_loop_config.png" />
</div>
<p><em>INTERPRETATIVE</em> means that the ETS will not update the equilibrium,
instead it will be using the initial equilibrium.</p>
<p>Please note, that it is better to select the same code as you used for
pre-iterrations. Because outputs of different equilibrium solver are not
necessary done with the same resolution. Therefore the routine saving
the information to the data base might brake due to uncompatible sizes
of some signals.</p>
<div class="figure align-center">
<img alt="_images/ets_equilibrium1.png" src="_images/ets_equilibrium1.png" />
</div>
</div>
</div>
<div class="section" id="ets-a-4-10b-transport">
<span id="id3"></span><h4><span class="section-number">3.2.1.6. </span>Transport<a class="headerlink" href="#ets-a-4-10b-transport" title="Permalink to this headline">Â¶</a></h4>
<p>The settings for TRANSPORT can be done inside the CONVERGENCE LOOP
composite actor. Therefore please do:</p>
<ul class="simple">
<li><p>right click on the box CONVERGENCE LOOP</p></li>
<li><p>select <strong>Open actor</strong></p></li>
<li><p>right click on the box TRANSPORT</p></li>
<li><p>select <strong>Configure actor</strong> to edit settings</p></li>
<li><p>choose your settings</p></li>
<li><p>press <strong>Commit</strong></p></li>
</ul>
<div class="figure align-center">
<img alt="_images/ets_transport1.png" src="_images/ets_transport1.png" />
</div>
<div class="section" id="transport-models">
<h5><span class="section-number">3.2.1.6.1. </span>Transport models<a class="headerlink" href="#transport-models" title="Permalink to this headline">Â¶</a></h5>
<p>ETS constructs the total transport coefficients from the combination of
Anomalous transport (model choice), Neoclassical transport (model
choice), Database transport (transport coefficients be saved to the
input shot) and Background transport (Transport coefficients defined
through the GUI interface)</p>
<p>D_tot = D_DB*M_DB + D_AN*M_AN + D_NC*M_NC + D_BG*M_BG</p>
<p>You should choose from the list of evailable models in each cathegory or
switch it <strong>OFF</strong></p>
<p>Individual multipliers for all channels shall be specified on the lower
level through the code parameters of Transport Combiner</p>
<div class="figure align-center">
<img alt="_images/ets_transport2.png" src="_images/ets_transport2.png" />
</div>
</div>
<div class="section" id="background-transport">
<h5><span class="section-number">3.2.1.6.2. </span>Background transport<a class="headerlink" href="#background-transport" title="Permalink to this headline">Â¶</a></h5>
<p>You can add the constant background level for each coefficient (ion and
impurity coefficients are expected to be the strings of [1:NION] and
[1:NIMP] elements respectively, separated by commas)</p>
<div class="figure align-center">
<img alt="_images/ets_transport3.png" src="_images/ets_transport3.png" />
</div>
</div>
<div class="section" id="edge-transport-barrier">
<h5><span class="section-number">3.2.1.6.3. </span>Edge transport barrier<a class="headerlink" href="#edge-transport-barrier" title="Permalink to this headline">Â¶</a></h5>
<p>In this section you can artificially supress the transport outside of
specified <em>RHO_TOR_NORM_ETB</em>. Total transport coefficients for all
transport channels (ne, ni, nz, Te, Ti,â¦) will be reduced to constant
values specified below (ion and impurity coefficients are expected to be
the strings [1:NION] and [1:NIMP] respectively)</p>
<div class="figure align-center">
<img alt="_images/ets_transport4.png" src="_images/ets_transport4.png" />
</div>
</div>
<div class="section" id="total-transport-coefficients">
<h5><span class="section-number">3.2.1.6.4. </span>Total transport coefficients<a class="headerlink" href="#total-transport-coefficients" title="Permalink to this headline">Â¶</a></h5>
<p>The fine tuning of of transport coefficients can be done through editing
the XML code parameters of the <strong>transport combiner</strong> actor:</p>
<ul class="simple">
<li><p>In Outline browse for transportcombiner</p></li>
<li><p>select <strong>Configure actor</strong></p></li>
<li><p>click <strong>Edit Code Parameters</strong></p></li>
<li><ul>
<li><p>If you select <strong>OFF</strong> contributions from all transport models to this channel will be
nullified;</p></li>
<li><p>If you select <strong>Multipliers_for_contributions_from</strong> the transport channel
will be activated, and the total transport coefficient will be
combined from active tranport models. You gust need to specify
multiplier against each channel;</p></li>
<li><p>For convective velocity there is an additional option
<strong>V_over_D_ratio_for_contributions_from</strong>.
With this option selected the combiner will ignore the
convective components provided by transport models. The convective
velocity will be determined from the diffusion coefficient by
applying fixed V/D ratio (
for inward pinch the values should be negative!
).</p></li>
</ul>
</li>
<li><p><strong>Save and exit</strong></p></li>
<li><p><strong>Commit</strong></p></li>
</ul>
<div class="figure align-center">
<img alt="_images/ets_transport_combiner.png" src="_images/ets_transport_combiner.png" />
</div>
</div>
</div>
<div class="section" id="mhd">
<span id="ets-a-4-10b-mhd"></span><h4><span class="section-number">3.2.1.7. </span>MHD<a class="headerlink" href="#mhd" title="Permalink to this headline">Â¶</a></h4>
<p>The settings for MHD type of events can be done inside the CONVERGENCE
LOOP composite actor. Therefore please do:</p>
<ul class="simple">
<li><p>right click on the box CONVERGENCE LOOP</p></li>
<li><p>select <strong>Open actor</strong></p></li>
<li><p>right click on the box MHD</p></li>
<li><p>select <strong>Configure actor</strong> to edit settings</p></li>
<li><p>choose your settings</p></li>
<li><p><strong>Commit</strong></p></li>
</ul>
<div class="figure align-center">
<img alt="_images/ets_mhd.png" src="_images/ets_mhd.png" />
</div>
<p>At the moment ETS allows only for NTM to be activated.</p>
<p>User can ajust the following NTM settings:</p>
<ul class="simple">
<li><p>NTM â <strong>ON</strong> means that ETS will add the NTM driven transport to the total
transport coefficient; <strong>OFF</strong> -ignored</p></li>
<li><p>NTMTransportMultiplier â the transport contrinution from NTM will be multiplied with this
value</p></li>
<li><p>Onset_NTM_time - activation time for the NTM mode</p></li>
<li><p>Onset_NTM_width - starting width of the mode</p></li>
<li><p>m_NTM_poloidal_number</p></li>
<li><p>n_NTM_toroidal_number</p></li>
<li><p>NTM_phase</p></li>
<li><p>NTM_frequency</p></li>
</ul>
<div class="figure align-center">
<img alt="_images/ets_mhd2.png" src="_images/ets_mhd2.png" />
</div>
</div>
<div class="section" id="sources-and-impurity">
<span id="ets-a-4-10b-sources"></span><h4><span class="section-number">3.2.1.8. </span>Sources and impurity<a class="headerlink" href="#sources-and-impurity" title="Permalink to this headline">Â¶</a></h4>
<p>The settings for SOURCES AND IMPURITY can be done inside the CONVERGENCE
LOOP composite actor. Therefore please do:</p>
<ul class="simple">
<li><p>right click on the box CONVERGENCE LOOP</p></li>
<li><p>select <strong>Open actor</strong></p></li>
<li><p>right click on the box SOURCES AND IMPURITY</p></li>
<li><p>select <strong>Configure actor</strong> to edit settings</p></li>
<li><p>choose your settings</p></li>
<li><p><strong>Commit</strong></p></li>
</ul>
<div class="figure align-center">
<img alt="_images/ets_source1.png" src="_images/ets_source1.png" />
</div>
<div class="section" id="analytical-impurity-sources">
<h5><span class="section-number">3.2.1.8.1. </span>Analytical &amp; Impurity sources<a class="headerlink" href="#analytical-impurity-sources" title="Permalink to this headline">Â¶</a></h5>
<p>There is a number of sources developed by WPCD, which are actors
or internal routines of the transport solver. You can activate them by
selecting <strong>ON / OFF</strong> in front of corresponding source:</p>
<ul class="simple">
<li><p>Database Sources â <strong>ON</strong> - ETS will pick up the evolution of source profiles saved to your
input shot/run; <strong>OFF</strong> -ignored</p></li>
<li><p>Ohmic Heating â <strong>ON</strong> - ETS will compute Ohmic heating internaly; <strong>OFF</strong> -ignored</p></li>
<li><p>Gaussian Sources â <strong>ON</strong> - ETS will add sources from the Gaussian source actor (you can
configure heat and particle deposition profiles by editing the code
parameters of the actor); <strong>OFF</strong> -ignored</p></li>
<li><p>Neutral Sources â <strong>ON</strong> - Fluid neutrals will be solved according to the boundary conditions
specified on Â¨Before_time_evolutionÂ¨ composite actor interface; <strong>OFF</strong> -ignored</p></li>
<li><p>Switch_IMPURITY â <strong>ON</strong> - Impurity density and radiative sources will be computed;
<strong>OFF</strong> -ignored; <strong>INTERPRETATIVE</strong> â profiles of impurity density will be read from input shot/run</p></li>
</ul>
<div class="figure align-center">
<img alt="_images/ets_sources2.png" src="_images/ets_sources2.png" />
</div>
</div>
<div class="section" id="hcd-sources">
<h5><span class="section-number">3.2.1.8.2. </span>HCD sources<a class="headerlink" href="#hcd-sources" title="Permalink to this headline">Â¶</a></h5>
<p>There is a number of sources developed by WPCD, that are
incorporated by the ETS workflow.</p>
<p>For the HCD sources please activate the type of heating source, by
ticking the box in front of it, and select the code to simulate it.</p>
<div class="figure align-center">
<img alt="_images/ets_sources3.png" src="_images/ets_sources3.png" />
</div>
<p>You also need to configure initial HCD settings. Therefore please:</p>
<ul class="simple">
<li><p>right click on the box BEFORE THE TIME EVOLUTION</p></li>
<li><p>select <strong>Open Actor</strong></p></li>
<li><p>right click on the box SETTINGS FOR HEATING AND CURRENT DRIVE</p></li>
<li><p>select <strong>Configure actor</strong></p></li>
<li><p>edit the stettings</p></li>
<li><p><strong>Commit</strong></p></li>
</ul>
<div class="figure align-center">
<img alt="_images/ets_sources4.png" src="_images/ets_sources4.png" />
</div>
<p>Please note that settings for NBI are done independent for each PINI.
Therefore, for NBI settings, please insert the values separated by
commas. The number of the element in the array corresponds to the number
of activated PINI. Maximum accepted number of PINIs = 16.</p>
<div class="figure align-center">
<img alt="_images/ets_sources5.png" src="_images/ets_sources5.png" />
</div>
</div>
<div class="section" id="power-control">
<h5><span class="section-number">3.2.1.8.3. </span>Power control<a class="headerlink" href="#power-control" title="Permalink to this headline">Â¶</a></h5>
<p>You also can activate the power control for the IMP5HCD sources.</p>
<div class="figure align-center">
<img alt="_images/ets_sources6.png" src="_images/ets_sources6.png" />
</div>
<p>If the POWER_CONTROL is not <strong>OFF</strong>, there are two modes of
operation: <strong>specific</strong> and <strong>frequency</strong></p>
<p>For <strong>specific</strong> you should specify the time sequence separated by commas
and the corresponding power sequence (where first power level
corresponds to the first time, second to second and etc.). Linear
interpolation will be done between the sequence points. For example: if
you give the power <strong>sequence</strong> = 2e6,4e6,1e6 and <strong>times</strong> = 0.0, 0.7, 1.5 (s) the delivered power would be:</p>
<div class="figure align-center">
<img alt="_images/ets_sources7.png" src="_images/ets_sources7.png" />
</div>
<p>For <strong>frequency</strong> you should specify the power levels sequence separated
by commas, start and end time of the power control and the frequency of
switching between these levels. For example: if you give the power
<strong>sequence</strong> = 2e6,4e6,1e6 and <strong>frequency</strong> = 10 (Hz) <strong>tstart</strong> = 0.0 (s)
<strong>tend</strong> = 1.5 (s) the delivered power would be:</p>
<div class="figure align-center">
<img alt="_images/ets_sources8.png" src="_images/ets_sources8.png" />
</div>
</div>
<div class="section" id="total-power">
<h5><span class="section-number">3.2.1.8.4. </span>Total power<a class="headerlink" href="#total-power" title="Permalink to this headline">Â¶</a></h5>
<p>Profiles of the total source for each channel are obtained from the the
individual contributions (Data Base, Gaussian, Neutrals, Impurity and
HCD) as a summ of all activated sources multiplied with coefficients
specified on the interface of the composite actor.</p>
<p>S_tot = S_DS*DSM + S_GS*GSM + S_Neu*NeuSM + S_IMP*IMPSM + S_HCD*HCDSM</p>
<p>The fine tuning of of sources can be done through editing the XML code
parameters of the source combiner actor:</p>
<ul class="simple">
<li><p>In the Outline browse for source combiner</p></li>
<li><p>select <strong>Configure actor</strong></p></li>
<li><p>click <strong>Edit Code Parameters</strong></p></li>
<li><p>If you like the sources to the particular equation being activated -
select <strong>from_input_CPOs</strong>, and then, put the multipliers against each
contribution; if you select <strong>OFF</strong> contributions from all sources to
this channel will be nullified.</p></li>
<li><p>save and exit</p></li>
<li><p><strong>Commit</strong></p></li>
</ul>
<div class="figure align-center">
<img alt="_images/ets_sources9.png" src="_images/ets_sources9.png" />
</div>
</div>
</div>
<div class="section" id="instantaneous-events-actuators">
<span id="ets-a-4-10b-inst-events"></span><h4><span class="section-number">3.2.1.9. </span>Instantaneous events &amp; Actuators<a class="headerlink" href="#instantaneous-events-actuators" title="Permalink to this headline">Â¶</a></h4>
<p>At the moment, user can swith <strong>ON</strong> and <strong>OFF</strong> two types of events: PELLET
and SAWTOOTH</p>
<div class="section" id="pellet">
<h5><span class="section-number">3.2.1.9.1. </span>Pellet<a class="headerlink" href="#pellet" title="Permalink to this headline">Â¶</a></h5>
<p>At the top level of the workflow you can configure times for pellet
injection</p>
<ul class="simple">
<li><p>right click on the box INSTANTANEOUS EVENTS &amp; ACTUATORS</p></li>
<li><p>select <strong>Configure actor</strong> to edit settings</p></li>
<li><p>Select Pellet_injection equal <strong>ON</strong> if you like to use pellet in your
simulation</p></li>
<li><p>Select mode of operation:</p>
<ul>
<li><p>Times_for_pellets equals <strong>specific</strong> â pellets will be shut at exact times specified in array times_pellet</p></li>
<li><p>Times_for_pellets equals <strong>frequency</strong> â pellets will be shut from
tstart_pellet until tend_pellet with a frequency_pellet</p></li>
</ul>
</li>
<li><p><strong>Commit</strong></p></li>
</ul>
<div class="figure align-center">
<img alt="_images/ets_instantaneous_events1.png" src="_images/ets_instantaneous_events1.png" />
</div>
<p>Parameters of individual pellet need to be configured through the
code_parameters of the PELLET actor. To access it go to <strong>Outline</strong> on the
right upper corner and open the following:</p>
<div class="figure align-center">
<img alt="_images/ets_instantaneous_events2.png" src="_images/ets_instantaneous_events2.png" />
</div>
<ul class="simple">
<li><p>right click on the actor PELLET</p></li>
<li><p>select <strong>Configure actor</strong></p></li>
<li><p>click <strong>Edit Code Parameters</strong></p></li>
<li><p>edit parameters and click <strong>save and exit</strong></p></li>
<li><p><strong>Commit</strong></p></li>
</ul>
<div class="figure align-center">
<img alt="_images/ets_instantaneous_events3.png" src="_images/ets_instantaneous_events3.png" />
</div>
<p>amn â atomic mass number: array of elements separated by space
(1:nelements) [-]</p>
<p>zn â nuclear charge: array of elements separated by space (1:nelements)
[-]</p>
<p>fraction â fraction of each element in the pellet, based on the number
of atoms: array of elements separated by space (1:nelements) [-]</p>
<p>rpell â radius of the pellet [m]</p>
<p>vpell â velocity of the pellet [m/s]</p>
<p>rcloud â radius of the pellet cloud [m], radial extension of the cloud =
2*rp0</p>
<p>lcloud â length of the pellet cloud along the field line [m]</p>
<p>Tcloud â temperature of the pellet cloud [eV]</p>
<p>Pellet path is specified by two points, for which R and Z coordinated
should be specified</p>
<p>R â R coordinates of the pivot and second points of the pellet path,
separated by space [m]</p>
<p>Z â Z coordinates of the pivot and second points of the pellet path,
separated by space [m]</p>
<p>Control switches allow to activate:</p>
<ul class="simple">
<li><p>drifts - YES - will activate radial displacement of deposition profile, same
for all path points</p></li>
<li><p>cooling - YES - will activate cooling of the other side of the plasma due to
parallel heat transport (essential for large pellets, which might
cross the same flux surface twice)</p></li>
<li><p>JINTRAC - YES - will provide temperature reduction consistent with the model
used in JETTO</p></li>
</ul>
</div>
<div class="section" id="sawtooth">
<h5><span class="section-number">3.2.1.9.2. </span>Sawtooth<a class="headerlink" href="#sawtooth" title="Permalink to this headline">Â¶</a></h5>
<p>At the top level of the workflow you can switch ON/OFF possible MHD
events</p>
<ul class="simple">
<li><p>right click on the box INSTANTANEOUS EVENTS &amp; ACTUATORS</p></li>
<li><p>select <strong>Configure actor</strong> to edit settings</p></li>
<li><p>Select SAWTOOTH <strong>ON</strong> if you like to use them in your simulation</p></li>
<li><p><strong>Commit</strong></p></li>
</ul>
</div>
<div class="section" id="actuators">
<h5><span class="section-number">3.2.1.9.3. </span>Actuators<a class="headerlink" href="#actuators" title="Permalink to this headline">Â¶</a></h5>
<p>At the top level of the workflow you can switch ON/OFF actuator for
Runaway Indicator (Runin) - this is <strong>ON</strong> by default. It only gives warning messages, and has no effect on the simulation results.</p>
<ul class="simple">
<li><p>right click on the box INSTANTANEOUS EVENTS &amp; ACTUATORS</p></li>
<li><p>select <strong>Configure actor</strong> to edit settings</p></li>
<li><p>Select actuator_runaways <strong>OFF</strong> if youâd like <strong>not</strong> to use Runaway Indicator in your simulation</p></li>
<li><p><strong>Commit</strong></p></li>
</ul>
</div>
</div>
<div class="section" id="scenario-output">
<span id="ets-a-4-10b-scenario"></span><h4><span class="section-number">3.2.1.10. </span>Scenario output<a class="headerlink" href="#scenario-output" title="Permalink to this headline">Â¶</a></h4>
<p>You can summarize the ETS run by activating the output to SCENARIO CPO
(as post-processing of the run).</p>
<p>To activate the SCENARIO output:</p>
<ul class="simple">
<li><p>right click on the box AFTER THE TIME EVOLUTION</p></li>
<li><p>select <strong>Configure actor</strong></p></li>
<li><p>select Generate_SCENARIO_output_from_ETS_run equal <strong>YES</strong></p></li>
<li><p><strong>Commit</strong></p></li>
</ul>
<div class="figure align-center">
<img alt="_images/ets_scenario.png" src="_images/ets_scenario.png" />
</div>
</div>
<div class="section" id="visualization-during-the-run">
<span id="ets-a-4-10a-visualization"></span><h4><span class="section-number">3.2.1.11. </span>Visualization during the run<a class="headerlink" href="#visualization-during-the-run" title="Permalink to this headline">Â¶</a></h4>
<p>There is a number tools visualizing the ETS run.</p>
<div class="section" id="multiple-tab-display">
<h5><span class="section-number">3.2.1.11.1. </span>Multiple Tab Display<a class="headerlink" href="#multiple-tab-display" title="Permalink to this headline">Â¶</a></h5>
<p>The display appeares automaticaly when the ETS workflow is launched. It
displays diagnostic text messages from the workflow on following topics:</p>
<ul class="simple">
<li><p>Input data statement</p></li>
<li><p>Iterations to check the initial convergence between EQUILIBRIUM and
CURRENT</p></li>
<li><p>Time evolution</p></li>
<li><p>Convergence of iteratinos within the time step</p></li>
<li><p>HCD settings</p></li>
<li><p>Power used by HCD actors durung the run</p></li>
</ul>
<p>Also the error messages from execution of the workflow will be displayed
here.</p>
<div class="figure align-center">
<img alt="_images/ets_visual1_a.png" src="_images/ets_visual1_a.png" />
</div>
</div>
<div class="section" id="etsviz">
<h5><span class="section-number">3.2.1.11.2. </span>ETSviz<a class="headerlink" href="#etsviz" title="Permalink to this headline">Â¶</a></h5>
<p>ETSviz is a python visualization tool with a graphical interphase that shows during the run the calculated kinetic
profiles evolution, particle energy sources and sinks, equilibrium evolution and other useful infoirmnation.
ETSviz appears automatically during the ETS run. If you would like to launch ETSviz you can find the script in $KEPLER/kplots</p>
<div class="figure align-center">
<img alt="_images/ETSviz.png" src="_images/ETSviz.png" />
</div>
</div>
</div>
</div>
<div class="section" id="list-of-actors">
<span id="ets-a-4-10b-list-actors"></span><h3><span class="section-number">3.2.2. </span>List of Actors<a class="headerlink" href="#list-of-actors" title="Permalink to this headline">Â¶</a></h3>
<div class="section" id="equilibrium-actors">
<span id="ets-a-4-10b-list-actors-equilibrium"></span><h4><span class="section-number">3.2.2.1. </span>Equilibrium actors<a class="headerlink" href="#equilibrium-actors" title="Permalink to this headline">Â¶</a></h4>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 23%" />
<col style="width: 23%" />
<col style="width: 35%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Code name</p></th>
<th class="head"><p>Code Category</p></th>
<th class="head"><p>Contact persons</p></th>
<th class="head"><p>Short description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>chease</p></td>
<td><div class="line-block">
<div class="line">Grad-Shafranov</div>
<div class="line">solver</div>
</div>
</td>
<td><p>Olivier Sauter</p></td>
<td><div class="line-block">
<div class="line">Chease is a fixed</div>
<div class="line">boundary Grad-Shafranov</div>
<div class="line">solver based on cubic</div>
<div class="line">hermitian finite</div>
<div class="line">elements see</div>
<div class="line">H. LÃ¼tjens, A.</div>
<div class="line">Bondeson, O. Sauter,</div>
<div class="line">Computer Physics</div>
<div class="line">Communications 97</div>
<div class="line">(1996) 219-260</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>emeq</p></td>
<td><div class="line-block">
<div class="line">G-S solver</div>
</div>
</td>
<td><p>Rui Coelho</p></td>
<td><p>fix-b equilibrium</p></td>
</tr>
<tr class="row-even"><td><p>spider</p></td>
<td><div class="line-block">
<div class="line">G-S solver</div>
</div>
</td>
<td><ol class="upperalpha simple" start="5">
<li><p>Fable</p></li>
</ol>
</td>
<td><p>ASTRA fix-B equilibrium</p></td>
</tr>
<tr class="row-odd"><td><p>helena</p></td>
<td><div class="line-block">
<div class="line">G-S solver</div>
</div>
</td>
<td><ol class="upperalpha simple" start="7">
<li><p>Huijsmans</p></li>
</ol>
</td>
<td><p>fix-B equilibrium</p></td>
</tr>
<tr class="row-even"><td><p>spider_imp12</p></td>
<td><div class="line-block">
<div class="line">G-S dolver</div>
</div>
</td>
<td><ol class="upperalpha simple" start="18">
<li><p>Coelho</p></li>
</ol>
</td>
<td><p>ASTRA fix-b equilibrium</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="core-transport-actors">
<span id="ets-a-4-10b-list-actors-coretransport"></span><h4><span class="section-number">3.2.2.2. </span>Core transport actors<a class="headerlink" href="#core-transport-actors" title="Permalink to this headline">Â¶</a></h4>
<table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 23%" />
<col style="width: 21%" />
<col style="width: 32%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Code name</p></th>
<th class="head"><p>Code Category</p></th>
<th class="head"><p>Contact persons</p></th>
<th class="head"><p>Short description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>BohmGB</p></td>
<td><div class="line-block">
<div class="line">Bohm/gyro-Bohm</div>
<div class="line">transport</div>
<div class="line">coefficients</div>
</div>
</td>
<td><ol class="upperalpha simple">
<li><p>Taroni</p></li>
</ol>
</td>
<td><p>Analytical model</p></td>
</tr>
<tr class="row-odd"><td><p>CDBM</p></td>
<td><div class="line-block">
<div class="line">CDBM</div>
<div class="line">transport</div>
<div class="line">coefficients</div>
</div>
</td>
<td><ol class="upperalpha simple" start="13">
<li><p>Honda</p></li>
</ol>
</td>
<td><p>Analytical model</p></td>
</tr>
<tr class="row-even"><td><p>Weiland</p></td>
<td><div class="line-block">
<div class="line">Transport</div>
<div class="line">coefficient from</div>
<div class="line">fluid turbulence</div>
</div>
</td>
<td><p>PÃ¤r Strand</p></td>
<td><p>Fluid model</p></td>
</tr>
<tr class="row-odd"><td><p>GLF23</p></td>
<td><div class="line-block">
<div class="line">Transport</div>
<div class="line">coefficient from</div>
<div class="line">drift wave</div>
<div class="line">turbulence</div>
</div>
</td>
<td><ol class="upperalpha simple" start="7">
<li><p>Stabler (GA)</p></li>
</ol>
</td>
<td><p>Gyrokinetic model</p></td>
</tr>
<tr class="row-even"><td><p>RITM</p></td>
<td><div class="line-block">
<div class="line">Transport</div>
<div class="line">coefficient from</div>
<div class="line">drift wave</div>
<div class="line">turbulence</div>
</div>
</td>
<td><p>PÃ¤r Strand</p></td>
<td><p>Gyrokinetic model</p></td>
</tr>
<tr class="row-odd"><td><p>MMM</p></td>
<td><div class="line-block">
<div class="line">Transport</div>
<div class="line">coefficient from</div>
<div class="line">drift wave</div>
<div class="line">turbulence</div>
</div>
</td>
<td><p>PPPL</p></td>
<td><p>Gyrokinetic model</p></td>
</tr>
<tr class="row-even"><td><p>EDWM/EDWMZ</p></td>
<td><div class="line-block">
<div class="line">Transport</div>
<div class="line">coefficient from</div>
<div class="line">drift wave</div>
<div class="line">turbulence</div>
</div>
</td>
<td><p>PÃ¤r Strand</p></td>
<td><p>multi-ion model</p></td>
</tr>
<tr class="row-odd"><td><p>nclass</p></td>
<td><div class="line-block">
<div class="line">Neoclassical</div>
<div class="line">transport</div>
<div class="line">coefficients</div>
</div>
</td>
<td><p>PÃ¤r Strand</p></td>
<td><p>Neoclassical model</p></td>
</tr>
<tr class="row-even"><td><p>neos</p></td>
<td><div class="line-block">
<div class="line">Neoclassical</div>
<div class="line">transport</div>
<div class="line">coefficients</div>
</div>
</td>
<td><p>Olivier Sauter</p></td>
<td><p>Neoclassical model</p></td>
</tr>
<tr class="row-odd"><td><p>neowesz</p></td>
<td><div class="line-block">
<div class="line">Neoclassical</div>
<div class="line">transport</div>
<div class="line">coefficients</div>
</div>
</td>
<td><p>Bruce Scott</p></td>
<td><div class="line-block">
<div class="line">Neoclassical transport</div>
<div class="line">coefficients based on</div>
<div class="line">the expression in John</div>
<div class="line">Wessonâs book Tokamaks.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>neoartz</p></td>
<td><div class="line-block">
<div class="line">Neoclassical</div>
<div class="line">transport</div>
<div class="line">coefficients</div>
</div>
</td>
<td><p>Bruce Scott</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>spitzer</p></td>
<td><div class="line-block">
<div class="line">Resistivity</div>
</div>
</td>
<td><p>Spitzer</p></td>
<td><p>Resistivity model</p></td>
</tr>
<tr class="row-even"><td><p>TGLF</p></td>
<td><div class="line-block">
<div class="line">Transport</div>
<div class="line">coefficient from</div>
<div class="line">drift wave</div>
<div class="line">turbulence</div>
</div>
</td>
<td><ol class="upperalpha simple" start="7">
<li><p>Stabler</p></li>
</ol>
</td>
<td><p>Gyrokinetic model</p></td>
</tr>
<tr class="row-odd"><td><p>NEO</p></td>
<td><div class="line-block">
<div class="line">Transport</div>
<div class="line">coefficient from</div>
<div class="line">drift kinetic</div>
<div class="line">equations</div>
</div>
</td>
<td><ol class="upperalpha simple" start="5">
<li><p>Belli</p></li>
</ol>
</td>
<td><p>Gyrokinetic model</p></td>
</tr>
<tr class="row-even"><td><p>QualiKiz</p></td>
<td><div class="line-block">
<div class="line">Transport</div>
<div class="line">coefficient from</div>
<div class="line">drift wave</div>
<div class="line">turbulence</div>
</div>
</td>
<td><ol class="upperalpha simple" start="10">
<li><p>Citrin</p></li>
</ol>
</td>
<td><p>Gyrokinetic model</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="heating-and-current-drive-actors">
<span id="ets-a-4-10b-list-actors-hcd"></span><h4><span class="section-number">3.2.2.3. </span>Heating and current drive actors<a class="headerlink" href="#heating-and-current-drive-actors" title="Permalink to this headline">Â¶</a></h4>
<table class="docutils align-default">
<colgroup>
<col style="width: 16%" />
<col style="width: 18%" />
<col style="width: 18%" />
<col style="width: 48%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Code name</p></th>
<th class="head"><p>Code Category</p></th>
<th class="head"><p>Contact persons</p></th>
<th class="head"><p>Short description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>gray</p></td>
<td><p>EC/waves</p></td>
<td><p>Lorenzo Figini</p></td>
<td><div class="line-block">
<div class="line">GRAY is a quasi-optical ray-tracing code</div>
<div class="line">for electron cyclotron heating &amp; current</div>
<div class="line">drive calculations in tokamaks.</div>
<div class="line">Code-parameter documentation can be found</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>travis</p></td>
<td><p>EC/waves</p></td>
<td><div class="line-block">
<div class="line">Nikolai</div>
<div class="line">Marushchenko</div>
<div class="line">and</div>
<div class="line">Lorenzo</div>
<div class="line">Figini</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Travis is a ray-tracing code for electron</div>
<div class="line">cyclotron heating &amp; current drive</div>
<div class="line">calculations in tokamaks.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>Torray-FOM</p></td>
<td><p>EC/waves</p></td>
<td><p>Egbert Westerhof</p></td>
<td><div class="line-block">
<div class="line">Torray-FOM is a ray-tracing code for</div>
<div class="line">electron cyclotron heating &amp; current</div>
<div class="line">drive calculations in tokamaks.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>bbnbi</p></td>
<td><p>NBI/source</p></td>
<td><p>Seppo Sipila</p></td>
<td><div class="line-block">
<div class="line">Calculate the deposition rates of neutrals</div>
<div class="line">beam particles, i.e. the input source for</div>
<div class="line">Fokker-Planck solvers (not the heating and</div>
<div class="line">current drive). Note that the number of</div>
<div class="line">markers generated by BBNBI is described by</div>
<div class="line">the kepler variable number_nbi_markers_in.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>nemo</p></td>
<td><p>NBI/source</p></td>
<td><div class="line-block">
<div class="line">Mireille</div>
<div class="line">Schneider</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Calculate the deposition rates of neutrals</div>
<div class="line">beam particles, i.e. the input source for</div>
<div class="line">Fokker-Planck solvers (not the heating and</div>
<div class="line">current drive). Code-parameter</div>
<div class="line">documentation can be found</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>nuclearsim</p></td>
<td><p>nuclear/source</p></td>
<td><p>Thomas Johnson</p></td>
<td><div class="line-block">
<div class="line">Simple code for nuclear sources from</div>
<div class="line">thermal/thermal reactions. Code-parameter</div>
<div class="line">documentation can be found</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>afsi</p></td>
<td><p>nuclear/source</p></td>
<td><p>Thomas Johnson</p></td>
<td><div class="line-block">
<div class="line">Complete code for nuclear sources from</div>
<div class="line">all reactions. Code-parameter</div>
<div class="line">documentation can be found</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>nbisim</p></td>
<td><div class="line-block">
<div class="line">NBI, alphas/</div>
<div class="line">Fokker-Planck</div>
</div>
</td>
<td><p>Thomas Johnson</p></td>
<td><div class="line-block">
<div class="line">Simple Fokker-Planck code calculating the</div>
<div class="line">collisional ion and electron heating from</div>
<div class="line">a particle source, either NBI or nuclear.</div>
<div class="line">Code-parameter documentation can be found</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>risk</p></td>
<td><div class="line-block">
<div class="line">NBI Fokker-</div>
<div class="line">Planck</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Mireille</div>
<div class="line">Schneider</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Bounce averaged steady-state Fokker-Planck</div>
<div class="line">solver calculating the collisional ion and</div>
<div class="line">electron heating from a particle source</div>
<div class="line">and the NBI current drive. Code-parameter</div>
<div class="line">documentation can be found</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>spot</p></td>
<td><div class="line-block">
<div class="line">NBI, alphas</div>
<div class="line">and</div>
<div class="line">ICRF Fokker</div>
<div class="line">-Planck</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Mireille</div>
<div class="line">Schneider</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Monte Carlo solver for the Fokker-Planck</div>
<div class="line">equation. Traces guiding centre orbits in</div>
<div class="line">a steady state magnetic equilibrium under</div>
<div class="line">the influence of Coloumb collisions and</div>
<div class="line">interactions with ICRF waves (through the</div>
<div class="line">RFOF library). The code can also be used</div>
<div class="line">for NBI and alpha particle modelling as it</div>
<div class="line">can handle source terms from the</div>
<div class="line">distsource CPO.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>ascot4serial</p></td>
<td><div class="line-block">
<div class="line">NBI, alphas,</div>
<div class="line">ICRF/</div>
<div class="line">Fokker-Planck</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Otto</div>
<div class="line">Asunta/</div>
<div class="line">Seppo</div>
<div class="line">Sipila</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Monte Carlo Fokker-Planck solver</div>
<div class="line">calculating the collisional ion and</div>
<div class="line">electron heating from a particle source</div>
<div class="line">and the NBI current drive.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>ascot4parallel</p></td>
<td><div class="line-block">
<div class="line">NBI, alphas,</div>
<div class="line">ICRF/</div>
<div class="line">Fokker-Planck</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Otto</div>
<div class="line">Asunta/</div>
<div class="line">Seppo</div>
<div class="line">Sipila</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Monte Carlo Fokker-Planck solver</div>
<div class="line">calculating the collisional ion and</div>
<div class="line">electron heating from a particle source</div>
<div class="line">and the NBI current drive.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>Lion</p></td>
<td><p>IC / waves</p></td>
<td><div class="line-block">
<div class="line">Olivier Sauter</div>
<div class="line">and</div>
<div class="line">Laurent</div>
<div class="line">Villard</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Global ICRF wave solver. Code-parameter</div>
<div class="line">documentation can be found</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>Cyrano</p></td>
<td><p>IC / waves</p></td>
<td><div class="line-block">
<div class="line">Ernesto Lerche</div>
<div class="line">and</div>
<div class="line">Dirk</div>
<div class="line">Van Eester</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Global ICRF wave solver. Code-parameter</div>
<div class="line">documentation can be found</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Eve</div>
</div>
</td>
<td><p>IC / waves</p></td>
<td><p>Remi Dumont</p></td>
<td><div class="line-block">
<div class="line">Global ICRF wave solver</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>StixReDist</p></td>
<td><p>IC / waves</p></td>
<td><div class="line-block">
<div class="line">Dirk</div>
<div class="line">Van Eester</div>
<div class="line">and</div>
<div class="line">Ernesto</div>
<div class="line">Lerche</div>
</div>
</td>
<td><div class="line-block">
<div class="line">1d Fokker-Planck solver for ICRF heating.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>ICdep</p></td>
<td><p>IC / waves</p></td>
<td><p>Thomas Johnson</p></td>
<td><div class="line-block">
<div class="line">Generates Waves-cpo with an IC wave field</div>
<div class="line">with Gaussian deposition profiles</div>
<div class="line">described by a combination of antenna-cpo</div>
<div class="line">input and through code parameters input.</div>
<div class="line">Code-parameter documentation can be found</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>ICcoup</p></td>
<td><p>IC / coupling</p></td>
<td><p>Thomas Johnson</p></td>
<td><div class="line-block">
<div class="line">Simple model for the coupling waves from</div>
<div class="line">ion cyclotron antennas to the plasma.</div>
<div class="line">Code-parameter documentation can be found</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="events-actors">
<span id="ets-a-4-10b-list-actors-events"></span><h4><span class="section-number">3.2.2.4. </span>Events actors<a class="headerlink" href="#events-actors" title="Permalink to this headline">Â¶</a></h4>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 18%" />
<col style="width: 17%" />
<col style="width: 46%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Code name</p></th>
<th class="head"><p>Code Category</p></th>
<th class="head"><p>Contact persons</p></th>
<th class="head"><p>Short description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>pelletactor</p></td>
<td><p>pellet</p></td>
<td><p>Denis Kalupin</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>pellettrigger</p></td>
<td><p>pellet</p></td>
<td><p>Denis Kalupin</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>sawcrash_slice</p></td>
<td><p>sawteeth</p></td>
<td><p>Olivier Sauter</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>sawcrit</p></td>
<td><p>sawteeth</p></td>
<td><p>Olivier Sauter</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>runaway_indicator</p></td>
<td><p>runaway</p></td>
<td><p>Roland Lohneroch
Gergo Pokol</p></td>
<td><div class="line-block">
<div class="line">Indicating the presence of runaway</div>
<div class="line">electrons:</div>
<div class="line">1) Indicate, whether electric field is</div>
<div class="line">below the critical level, thus runaway</div>
<div class="line">generation is impossible.</div>
<div class="line">2) Indicate, whether runaway electron</div>
<div class="line">growth rate exceeds a preset limit. This</div>
<div class="line">calculation takes only the Dreicer runaway</div>
<div class="line">generation method in account and assumes a</div>
<div class="line">velocity distribution close to Maxwellian,</div>
<div class="line">therefore this result should be considered</div>
<div class="line">with caution. The growth rate limit can be</div>
<div class="line">set via an input of the actor. Limit value</div>
<div class="line">is set to \( 10^{12} \) particle per
second by default.</div>
<div class="line">(This growth rate generates a runaway</div>
<div class="line">current of approximately 1kA considering a</div>
<div class="line">10 seconds long discharge.)</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="non-physics-actors">
<h4><span class="section-number">3.2.2.5. </span>Non-physics actors<a class="headerlink" href="#non-physics-actors" title="Permalink to this headline">Â¶</a></h4>
<p>The ETS uses the following list of non-physics actors: addECant,
addICant, backgroundtransport, calculateRHO, changeocc, changepsi,
changeradii, checkconvergence, controlAMIX, coredelta2coreprof,
correctcurrent, deltacombiner, emptydistribution, emptydistsource,
emptywaves, eqinput, etsstart, fillcoreimpur, fillcoreneutrals,
fillcoreprof, fillcoresource, fillcoretransp, fillequilibrium,
fillneoclassic, filltoroidfield, gausiansources, geomfromcpo,
hcd2coresource, ignoredelta, ignoreimpurity, ignoreneoclassic,
ignoreneutrals, ignorepellet, ignoresources, ignoretransport, IMP4dv,
IMP4imp, importimptransport, itmimpurity, itmneutrals,
merger4distribution, merger4distsource, merger4waves, nbifiller,
neoclassic2coresource, neoclassic2coretransp, parabolicprof,
plasmacomposition, PowerFromArray, PowerModulation, profilesdatabase,
readjustprof, sawupdate_slice, scaleprof, sourcecombiner,
sourcedatabase, transportcombiner, transportdatabase, wallFiller and
waves2sources.</p>
</div>
</div>
</div>
<div class="section" id="turbulent-flux-quantities-in-transport-models">
<h2><span class="section-number">3.3. </span>Turbulent Flux Quantities in Transport Models<a class="headerlink" href="#turbulent-flux-quantities-in-transport-models" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="overview">
<h3><span class="section-number">3.3.1. </span>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">Â¶</a></h3>
<p>In conventional transport modelling, all quantities appearing in the
equations are 1-D, in some radial coordinate (poloidal flux, normalised
radius, etc). In general any monotonic radial coordinate is acceptable.
In the TF-EU-IM, the toroidal flux radius is standard. All we need from
the radial coordinate is the transformation to get to <span class="math notranslate nohighlight">\(V,\)</span> the
volume enclosed by the flux surface, which is fundamental to the
governing equations, which are conservation laws.</p>
<p>What we have to do is to take a measured result, which is a
time-averaged fluctuation-based transport flux and turn it into 1-D
quantities suitable to modelling. This is done using the flux surface
average, explained in conventions. The transport equations themselves
constitute a mean field approximation to the 3-D conservation laws. For
the fundamentals encountered in transport modelling see R Hazeltine and
J Meiss, Plasma Confinement (Addison-Wesley, 1992) chapter 8. For the
special properties of transport driven by small-scale pressure driven
ExB microturbulence see B Scott, âThe character of transport caused by
ExB drift turbulence,â Phys Plasmas 10 (2003) 963-976.</p>
<p>For ambipolarity we follow the rules for dynamical alignment, which
follows the physics of how electron fluctuations determine the ExB
velocity fluctuations, which then advect all species. Magnetic flutter
nonlinearities act independently of this, but in our modelling they are
used solely for heat fluxes since the averaged particle transport due to
magnetic flutter and the current cancels, leaving the parallel ion
velocity which we neglect for this purpose. The reference for dynamical
alignment is B Scott, âDynamical alignment in three species tokamak edge
turbulence,â Phys Plasmas 12 (2005) 082305.</p>
<p>Note: there are now auxiliary actors provided for this purpose: IMP4DV,
which does the D/V conversion and enforces ambipolarity assuming absence
of impurities, and IMP4imp, which subsequently enforces ambipolarity for
the set of main ion and impurity species. The IMP4DV actor should be
invoked directly after the transport model actor in the workflow chain,
if the model produces only fluxes or if the coefficients have to be
modified with the flux given. Ambipolarity is done using IMP4imp if the
coreimpurity CPO is used in the workflow.</p>
</div>
<div class="section" id="particle-flux-as-an-example">
<h3><span class="section-number">3.3.2. </span>Particle Flux as an Example<a class="headerlink" href="#particle-flux-as-an-example" title="Permalink to this headline">Â¶</a></h3>
<p>The mean field equation governing particle balance is the transport
equation for electrons,</p>
<div class="math notranslate nohighlight">
\[{\partial \over \partial t} \langle n \rangle + \langle \vec \nabla \cdot \widetilde n \vec {\widetilde v}_E \rangle = S\]</div>
<p>in which the tilde symbol over the n and v denotes fluctuating quantities
and we neglect all transport processes except ExB eddy diffusion. The ExB
velocity is given by</p>
<div class="math notranslate nohighlight">
\[\vec v_E = {c \over B^2} \vec B \times \vec \nabla \phi\]</div>
<p>where <span class="math notranslate nohighlight">\(\phi\)</span> is the electrostatic potential.</p>
<p>The angle brackets denote the flux surface average, and we will use the
property that the flux surface average of a divergence of a vector is
the volume derivative of the flux surface average of a contravariant
volume component of the vector, in this case</p>
<div class="math notranslate nohighlight">
\[\langle \vec \nabla \cdot \vec \Gamma \rangle = {\partial \over \partial V} \langle \Gamma^V \rangle\]</div>
<p>where <span class="math notranslate nohighlight">\(\Gamma\)</span> is the particle flux whose flux-surface averaged volume component is</p>
<div class="math notranslate nohighlight">
\[\langle \Gamma^V \rangle = \langle \widetilde n \widetilde v_E^V \rangle\]</div>
<p>This is converted to expression in terms of the radial coordinate (
rho` using the fact that both <span class="math notranslate nohighlight">\(V\)</span> and <span class="math notranslate nohighlight">\(\rho\)</span> are flux
quantities whose gradients are parallel to each other. We have</p>
<div class="math notranslate nohighlight">
\[{\partial \over \partial V} = {1 \over V'_\rho}{\partial \over \partial \rho}\qquad \Gamma^\rho = {1\over V'_\rho}\Gamma^V \qquad V'_\rho = {\partial V \over\partial \rho} \qquad g^{VV} = (V'_\rho)^2 g^{\rho\rho}\]</div>
<p>so we can write the transport equation as</p>
<div class="math notranslate nohighlight">
\[{\partial n \over \partial t}+{1 \over V'_\rho}{\partial \over \partial \rho}V'_\rho \langle \Gamma^\rho \rangle = S,\]</div>
<p>where we have replaced <span class="math notranslate nohighlight">\(\langle n \rangle\)</span> with <span class="math notranslate nohighlight">\(n\)</span> following the assumptions of the 1-D version of mean field transport theory.</p>
<p>With all quantities now expressed in terms of flux quantities, we are
free to characterise the transport flux <span class="math notranslate nohighlight">\(\langle \Gamma^\rho \rangle\)</span>
in an arbitrary way, so long as only flux quantities appear. The
flux expansion within the flux surface as well as expansion or
contraction of surfaces of constant <span class="math notranslate nohighlight">\(\rho\)</span> is treated using the
metric coefficient <span class="math notranslate nohighlight">\(g^{ \rho \rho}\)</span> which is dimensionless. This way
we can characterise transport in terms of an effective diffusivity and
an effective frictional slip velocity which are given in SI units. By
convention both of these are done solely via <span class="math notranslate nohighlight">\(g^{ \rho \rho}\)</span> for
convenience, also reflecting that the effective velocity is actually
marking off-diagonal diffusive elements. Our convention for this follows
the ETS code and is given by</p>
<div class="math notranslate nohighlight">
\[\langle \Gamma^\rho \rangle = \langle g^{\rho \rho} \rangle \left( n V_{{\rm eff}} - D_{{\rm eff}}{\partial n\over \partial \rho} \right)\]</div>
<p>So despite the special spatial distribution of any particular transport
process (ie, the underlying instability or nonlinear free energy access),
the flux-surface averaged flux itself and its expression in terms of
diffusion and frictional slip are identical characterisations.</p>
</div>
<div class="section" id="metric-coefficients">
<h3><span class="section-number">3.3.3. </span>Metric Coefficients<a class="headerlink" href="#metric-coefficients" title="Permalink to this headline">Â¶</a></h3>
<p>Transport modellers want the Ds and Vs as physical quantities in SI
units. In general the fluxes are (magnetic) flux surface averaged
quantities, which implies the existence of metric elements in the
conversion. In our case we need <span class="math notranslate nohighlight">\(\langle g^{\rho \rho} \rangle\)</span>
where <span class="math notranslate nohighlight">\(\rho\)</span> is the toroidal flux radius in meters, so the metric
elements are dimensionless. In the equilibrium CPO, this is gm3 under
equilibrium%profiles_1d in the structure.</p>
<p>Note this is different from the ASTRA code which casts the Vs as proper
velocities, i.e., with one factor of grad-rho given by <span class="math notranslate nohighlight">\(\langle
\sqrt{g^{\rho \rho}} \rangle\)</span> which is gm7 under
equilibrium%profiles_1d in the structure. The units are the same and the
informational content is the same, but this difference has to be taken
into account in any transport modelling and benchmarking.</p>
</div>
<div class="section" id="heat-fluxes">
<h3><span class="section-number">3.3.4. </span>Heat Fluxes<a class="headerlink" href="#heat-fluxes" title="Permalink to this headline">Â¶</a></h3>
<p>The heat flux is treated in a similar way, with transport equation</p>
<div class="math notranslate nohighlight">
\[{3 \over 2}{\partial p_e \over \partial t} +{1 \over V'_\rho}{\partial \over \partial \rho} V'_\rho \langle q_e^\rho \rangle = Q_e + \sum_{{\rm ions}}T_{ei},\]</div>
<p>for electrons, with <span class="math notranslate nohighlight">\(T_{ei}\)</span> giving the species transfer and <span class="math notranslate nohighlight">\(Q_e\)</span>
the source. For ExB transport the heat flux has a advective (also
called convective) and a conductive piece given by</p>
<div class="math notranslate nohighlight">
\[q_E = q_E{}_{{\rm cond}} + (3/2) T \Gamma_E\]</div>
<p>which appears with a 3/2 due to the Poynting cancellation. For
magnetic flutter transport the advective piece appears with the usual
factor,</p>
<div class="math notranslate nohighlight">
\[q_m = q_m{}_{{\rm cond}} + (5/2) T \Gamma_m\]</div>
<p>Here the forms are given for each species and <span class="math notranslate nohighlight">\(E\)</span> and <span class="math notranslate nohighlight">\(m\)</span> refer
to the ExB eddy and magnetic flutter channels, respectively. For reasons
given below we are neglecting the magnetic flutter piece <span class="math notranslate nohighlight">\(\Gamma_m\)</span>
for the time being, and then the flutter piece merely adds to the heat
diffusivity.</p>
<p>The forms of these due to the fluctuations are then</p>
<div class="math notranslate nohighlight">
\[\langle q^\rho \rangle = (3/2) \langle \widetilde p \widetilde v_E^\rho \rangle + \langle \widetilde q_\parallel \widetilde b^\rho \rangle\]</div>
<p>which breaks into advective and conductive pieces according to linearisation
of the pressure fluctuations</p>
<div class="math notranslate nohighlight">
\[\langle q_{{\rm cond}}^\rho\rangle = (3/2) n \langle \widetilde T \widetilde v_E^\rho\rangle + \langle \widetilde q_\parallel \widetilde b^\rho\rangle \qquad\qquad \langle q_{{\rm adv}}^\rho \rangle = (3/2)T \Gamma = (3/2)T\langle\widetilde n \widetilde v_E^\rho \rangle\]</div>
<p>hence the density fluctuation piece is accounted for by the particle flux.
Neglect of the magnetic flutter advective piece (and particle flux) is the
same as neglect of the <span class="math notranslate nohighlight">\({\widetilde u_\parallel} {\widetilde b^ \rho}\)</span> nonlinearity (in the delivery of the results, not in the turbulence
computations themselves).</p>
<p>The total conductive flux is then represented by</p>
<div class="math notranslate nohighlight">
\[\langle q_{{\rm cond}}^\rho \rangle = \langle g^{\rho \rho} \rangle \left( nTY_{{\rm eff}} - n \chi_{{\rm eff}}{\partial T \over \partial \rho} \right)\]</div>
<p>with <span class="math notranslate nohighlight">\(\chi\)</span> and <span class="math notranslate nohighlight">\(Y\)</span> giving the heat diffusion and frictional
slip pieces for each species, respectively (these are in diff_eff and
vconv_eff in the CPO for each quantity).</p>
<p>Operationally, the turbulence module communicates the diff_eff and
vconv_eff due to each transport channel for each species to the
transport solver, and the metric coefficients are used by both modules.
The two modules can be on arbitrarily different grids, which communicate
through standard interpolation. This despite the fact that transport at
the micro-level is angle dependent (in general, it can be 3-D in the
time average if the sources are 3-D). The effective transport is 1-D so
long as parallel sound transit within the flux surface remains fast
compared to the local transport time. This breaks down anyway in the
edge, so the fact that the volume is a problematic coordinate and the
flux surface average is a problematic operation on open field lines
doesnât enter.</p>
</div>
<div class="section" id="ds-and-vs-from-turbulence-codes-to-transport-solvers">
<h3><span class="section-number">3.3.5. </span>Ds and Vs from Turbulence Codes to Transport Solvers<a class="headerlink" href="#ds-and-vs-from-turbulence-codes-to-transport-solvers" title="Permalink to this headline">Â¶</a></h3>
<p>To serve the results from turbulence codes to transport solvers, we have
to turn the fluxes (results) into diffusivities and effective velocities
(coefficients, Ds and Vs for short), which represent more information
than is at hand. Transport solvers must work with Ds and Vs because they
use implicit schemes. The matrix must be diagonally dominant; hence one
cannot simply use the Vs. Fluxes which are zero and/or negative should
be given with positive diffusivities for the solvers to work. We need a
set of rules to provide this.</p>
<p>Considering the particle and heat transport fluxes for a given species,
we convert the gradient in to a logarithmic derivative and express the
flux in terms of a specific flux, which has units of velocity,</p>
<div class="math notranslate nohighlight">
\[\begin{split}F &amp;= \frac{1}{n} \langle g^{\rho\rho}\rangle^{-1} \langle \Gamma^\rho \rangle= V_{{\rm eff}} - D_{{\rm eff}}\frac{\partial \log n}{\partial \rho}\\
G &amp;= \frac{1}{nT} \langle g^{\rho \rho} \rangle^{-1} \langle q^\rho_{{\rm cond}}\rangle = Y_{{\rm eff}} - \chi_{{\rm eff}}\frac{\partial \log T}{\partial \rho}\end{split}\]</div>
<p>wherein the conductive part of the heat flux (without the <span class="math notranslate nohighlight">\(3 \Gamma / 2\)</span> enters.</p>
<p>The choice of what to do with the Ds and Vs is somewhat arbitrary. The
needs of implicit transport solvers is for a positive D regardless of
the value or sign of either flux. We decide this by putting a limit on
the effective Prandtl number or its inverse: the larger specific flux is
taken to be entirely diffusive, with the effective velocity set to zero.
Furthermore, to address cases with very small or negative gradients, we
use proxy variables for the scale lengths to calculate the provisional
diffusivities before using the Prandtl number limitation to turn these
into actual diffusivities. Finally, the rest of the flux is asigned to
the effective velocity, so that the D and V formula reflects the actual
specific flux.</p>
<p>The Prandtl number limitation is expressed as follows. If the smaller
specific flux is within a factor of 5 of the larger, then both are
purely diffusive and the effective velocities are both zero. If not,
then the D ratio is set to 5, with the result that the smaller D, having
been corrected, is accompanied by the corresponding V, which is now
nonzero. The specific flux with the larger D will be returned with a V
which is zero.</p>
<p>The rationale is that the turbulent mixing by the ExB velocity affects
all processes, but that linear forcing can shift the average phase shift
of the fluctuations such that the effective flux can be small or
negative. The simplest example is adiabatic electrons, for which the ion
heat flux is robust but the particle flux is zero. In most situations
the specific heat flux will be the larger, and hence the familiar
situation is that of a D and V for the particle flux but a D (the chi)
only for the conductive heat flux.</p>
<p>The full algorithm starting with the specific fluxes appears as</p>
<div class="math notranslate nohighlight">
\[\begin{split}L_n^{-1} &amp;= \max \left( {1 \over R}, \left\vert {\partial \log n \over \partial \rho} \right\vert \right) \quad L_T^{-1} = \max \left( {1 \over R},\left\vert {\partial \log T \over \partial \rho} \right\vert \right)\\
D' &amp;=\left \vert F \right \vert L_n \quad \chi' = \left \vert G \right \vert L_T \\
D &amp;= \max \left( D', {1\over 5} \chi' \right) \quad \chi = \max\left( \chi', {1 \over 5} D' \right) \\
V &amp;= \left( F + D {\partial \log n \over \partial \rho} \right) \quad Y = \left( G + \chi \frac{\partial \log T}{\partial \rho} \right)\end{split}\]</div>
<p>and all four elements are set. Note that the channels are done in parallel
except for the Prandtl correction, in which the Maxâs are taken
sequentially. For the provisional diffusivities, absolute values are used
to ensure positive values which are needed by transport solvers.</p>
<p>Note how in the end the actual gradients are used. If the gradients are
moderate then their actual values are used, and if the Prandtl
correction is not invoked, then both channels are diagonal. In any case
the full relation is used to get the effective velocities (V and Y) so
having set the rules to handle the arbitrariness of the diffusivities (D
and chi) to guarantee reasonable diagonal dominance in a transport
solver, the Dâs and Vâs agree with the fluxes themselves.</p>
<p>If there are more than two specific fluxes per species to consider, then
we treat each scale length separately as above and use N-way maxima in
the Prandtl correction for the N channels.</p>
</div>
<div class="section" id="ambipolarity">
<h3><span class="section-number">3.3.6. </span>Ambipolarity<a class="headerlink" href="#ambipolarity" title="Permalink to this headline">Â¶</a></h3>
<p>There remains the issue of ambipolarity of the D and V for particle
flux. For a pure singly charged plasma the ion and electron Ds and Vs
should be equal. Even if the turbulence model is gyrokinetic or
gyrofluid, in which case the gyrocenter charge density is not zero but
is equal to the generalised vorticity (polarisation), the quantities
given to a transport solver should follow the rules for a fluid
representation. However, transport modelling usually applies
ambipolarity rules to the electrons after computing the ions, while the
action of turbulence is actually the other way around: Dynamical
alignment refers to the process by which (1) electron parallel dynamics
controls the electrostatic fluctuations, then (2) the resulting ExB
velocity advects all species equally. So we correct the particle fluxes
by assuming the electrons determine the D according to the above
procedure and then (1) the fluctuations in the flux-inducing part of the
spectrum for the logarithmic densities are the same, and (2) the Dâs are
the same. Then the Vâs are solved for again, by taking</p>
<div class="math notranslate nohighlight">
\[D_z = D_e = D \qquad \qquad V_z = V_e + D {\partial \log b_z \over \partial \rho} \qquad \qquad b_z = n_z/n_e\]</div>
<p>This is better than the transport modelling convention but will give them
the same information in a different way, and they will compute ambipolar
particle fluxes (radial transport of charge is zero).</p>
</div>
<div class="section" id="statistical-character">
<h3><span class="section-number">3.3.7. </span>Statistical Character<a class="headerlink" href="#statistical-character" title="Permalink to this headline">Â¶</a></h3>
<p>Turbulence has a statistical character, so convergence to a mean is not
monotonic and when within one std dev of the mean there is no further
convergence. The diffusivity for ExB turbulence is comparable to</p>
<div class="math notranslate nohighlight">
\[D_E = \left. \langle (\widetilde v_E)^2 \rangle \right / \langle (\varpi)^2 \rangle^{1/2} \qquad \qquad \varpi_E = {c \over B} \nabla_\perp^2 \widetilde \phi\]</div>
<p>where <span class="math notranslate nohighlight">\(\varpi_E\)</span> is the ExB vorticity fluctuation, and these angle
brackets denote the ensemble average. To get an ensemble average over a
statistical quantity in practice, one must do some sort of finite-time
running averaging.</p>
<p>For transport modelling, the transport coefficients derived from a
turbulence code should always be given in terms of <a class="reference external" href="#imp4_exponential_averages">running exponential
averages.</a></p>
</div>
</div>
<div class="section" id="running-exponential-average">
<span id="imp4-exponential-averages"></span><h2><span class="section-number">3.4. </span>Running Exponential Average<a class="headerlink" href="#running-exponential-average" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="id4">
<h3><span class="section-number">3.4.1. </span>Overview<a class="headerlink" href="#id4" title="Permalink to this headline">Â¶</a></h3>
<p>In conventional transport modelling, turbulent fluxes are modelled in terms
of processes which are diffusive in the local relaxation sense, with the
average flux given by a diffusion coefficient and an effective pinch
velocity. The equations are of dominantly parabolic character, which means
in practice that an iterate will move monotonically towards the solution in
parameter space.</p>
<p>This is not the case for turbulence. Convergence is statistical, which is
something different than a diffusive relaxation. If turbulence is
stationary, it is meant only that the mean of a distribution of iterates is
stationary, not the iterates themselves. The standard deviation can be
significant, of order unity compared to the mean, of any distribution of
iterates.</p>
<p>This makes for a noisy signal if the output of a turbulence code is used
for transport coefficients in a workflow. A sound way to overcome the
attendant problems is to use a moving average. Even an average over a
moving window can be as noisy as the original signal, however. What works
better is a weighted average over recent past values. A method to get this
is called a running exponential average, which is essentially the same
thing as a convolution integral over an exponential memory decay times the
past signal. It turns out to be very easy to obtain this without saving
past values.</p>
<p>The original reference for the following is S W Roberts, âControl Chart
Tests Based on Geometric Moving Averages,â Technometrics 1 (1959)
239-250, cited by all the good WWW resources, including the Wikipedia
page on Moving Averages and the NIST Statistical Handbook online.</p>
</div>
<div class="section" id="definition">
<h3><span class="section-number">3.4.2. </span>Definition<a class="headerlink" href="#definition" title="Permalink to this headline">Â¶</a></h3>
<p>Consider a process <span class="math notranslate nohighlight">\(p ( \vec u )\)</span> which is a functional of dependent
variables <span class="math notranslate nohighlight">\(\vec u\)</span>. Measure <span class="math notranslate nohighlight">\(p\)</span> at discrete time intervals
<span class="math notranslate nohighlight">\(t_n,\)</span> with values <span class="math notranslate nohighlight">\(p_n=p(t_n)\)</span> and interval length
<span class="math notranslate nohighlight">\(\tau=t_n-t_{n-1}\)</span>. The moving exponential average <span class="math notranslate nohighlight">\(A_n=A(p_n)\)</span>
on the <span class="math notranslate nohighlight">\(n \hbox{-th}\)</span> interval is defined as</p>
<div class="math notranslate nohighlight">
\[A_n = \epsilon p_n + (1-\epsilon)A_{n-1} \qquad \qquad \hbox{with} \qquad \epsilon=\alpha \tau\]</div>
<p>in which the small parameter <span class="math notranslate nohighlight">\(\epsilon\)</span> is given in terms of the interval <span class="math notranslate nohighlight">\(\tau\)</span> and an inverse time constant <span class="math notranslate nohighlight">\(\alpha.\)</span></p>
<p>In the first instance <span class="math notranslate nohighlight">\(p\)</span> is measured there is no <span class="math notranslate nohighlight">\(A\)</span> so the
first value of <span class="math notranslate nohighlight">\(A\)</span> is simply set to <span class="math notranslate nohighlight">\(p\)</span> since it can be
assumed that the initial state for <span class="math notranslate nohighlight">\(p\)</span> has persisted for infinite
previous time up to the initial time point.</p>
</div>
<div class="section" id="differential-equation">
<h3><span class="section-number">3.4.3. </span>Differential Equation<a class="headerlink" href="#differential-equation" title="Permalink to this headline">Â¶</a></h3>
<p>The equivalent differential equation is found by forming the relevant
finite difference,</p>
<div class="math notranslate nohighlight">
\[A_n - A_{n-1} = \epsilon (p_n - A_{n-1})\]</div>
<p>which we can also cast as</p>
<div class="math notranslate nohighlight">
\[(1-\epsilon)(A_n - A_{n-1}) = \epsilon (p_n - A_n)\]</div>
<p>Taking the limit <span class="math notranslate nohighlight">\(\tau \to 0\)</span> is the same as taking <span class="math notranslate nohighlight">\(\epsilon \to 0\)</span> so both of these expressions become equivalent to</p>
<div class="math notranslate nohighlight">
\[{\partial A \over \partial t} = \alpha(p-A)\]</div>
<p>whose solution is given below.</p>
</div>
<div class="section" id="equivalence-to-past-time-convolution-integral">
<h3><span class="section-number">3.4.4. </span>Equivalence to Past-Time Convolution Integral<a class="headerlink" href="#equivalence-to-past-time-convolution-integral" title="Permalink to this headline">Â¶</a></h3>
<p>The solution of the above differential equation is given by the method
of undetermined coefficients,</p>
<div class="math notranslate nohighlight">
\[{\partial A \over \partial t} +\alpha A = \alpha p \ \ e^{-\alpha t}{\partial \over \partial t} \left( e^{ \alpha t} A \right) = \alpha p \ \ {\partial \over \partial t} \left( e^{\alpha t} A \right) = \alpha p e^{\alpha t}\]</div>
<p>We may integrate this over all past time, to find</p>
<div class="math notranslate nohighlight">
\[A(t) = \int_{-\infty}^t \alpha dt' p(t') e^{-\alpha (t-t') }\]</div>
<p>This is a convolution integral over the kernel <span class="math notranslate nohighlight">\(e^{-\alpha(t-t')}\)</span>
and the signal <span class="math notranslate nohighlight">\(p(t')\)</span>. The time constant <span class="math notranslate nohighlight">\(\alpha^{-1}\)</span> is
just the memory decay time, while if <span class="math notranslate nohighlight">\(p\)</span> is constant then the
integral yields unity times <span class="math notranslate nohighlight">\(p\)</span>. This is the same as the
normalisation with the <span class="math notranslate nohighlight">\((1-\epsilon)\)</span> factor in the average formula
above, which is needed since the interval is of finite size.</p>
<p>Hence the running exponential average is operationally the same as a memory
decay integral over past time. The elegant feature is the need to keep only
the current value of <span class="math notranslate nohighlight">\(A\)</span>, as it already contains all that is needed
of the past time evolution of <span class="math notranslate nohighlight">\(p\)</span>.</p>
</div>
<div class="section" id="notes">
<h3><span class="section-number">3.4.5. </span>notes<a class="headerlink" href="#notes" title="Permalink to this headline">Â¶</a></h3>
<p>Some properties of the running exponential average and how to choose its
main time-memory parameter:</p>
<ul class="simple">
<li><p>The <span class="math notranslate nohighlight">\((1-\epsilon)\)</span> factor is needed for normalisation</p></li>
<li><p>if <span class="math notranslate nohighlight">\(p=\hbox{constant}\)</span> then <span class="math notranslate nohighlight">\(A=p\)</span> for all <span class="math notranslate nohighlight">\(t\)</span></p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>the integral with <span class="math notranslate nohighlight">\(\alpha dt'\)</span> yields unity</p></li>
<li><p>the <span class="math notranslate nohighlight">\(\epsilon\)</span> and <span class="math notranslate nohighlight">\((1-\epsilon)\)</span> factors add to unity</p></li>
<li><p>therefore set the first value of <span class="math notranslate nohighlight">\(A\)</span> to the first value of <span class="math notranslate nohighlight">\(p\)</span></p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>in choosing the memory decay time <span class="math notranslate nohighlight">\(\alpha^{-1} \dots\)</span></p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>one should have <span class="math notranslate nohighlight">\(\alpha \tau_{cor} \ll 1\)</span></p></li>
<li><p>best results are for <span class="math notranslate nohighlight">\(\alpha \tau_{sat} \sim 1\)</span></p></li>
<li><p>some trial/error required; edge turbulence likes <span class="math notranslate nohighlight">\(\alpha^{-1}=200 L_\parallel / c_s\)</span></p></li>
</ul>
</div></blockquote>
<p>In these expressions <span class="math notranslate nohighlight">\(\tau_{{cor}}\)</span> and <span class="math notranslate nohighlight">\(\tau_{{sat}}\)</span> are
the correlation and saturation times of the turbulence, respectively.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="es.html" class="btn btn-neutral float-right" title="4. Equilibrium and MHD Stability workflow (EQSTABIL)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="infrastructure.html" class="btn btn-neutral float-left" title="2. Infrastructure" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2019, WPCD.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>